---
lab:
  title: Azure Storage を調べる
  module: Explore Azure Storage for non-relational data
---

# Azure Storage を調べる

この演習では、自分の Azure サブスクリプションで Azure Storage アカウントをプロビジョニングし、それを使用してデータを格納するさまざまな方法を検討します。

このラボは完了するまで、約 **15** 分かかります。

## 開始する前に

管理レベルのアクセス権を持つ [Azure サブスクリプション](https://azure.microsoft.com/free)が必要です。

## Azure Storage アカウントをプロビジョニングする

Azure Storage を使用する際の最初の手順は、Azure サブスクリプションに Azure Storage アカウントをプロビジョニングすることです。

1. まだサインインしていない場合は、[Azure portal](https://portal.azure.com?azure-portal=true) にサインインします。
1. Azure portal ホーム ページで、左上隅にある **[&#65291; リソースの作成]** を選択し、"ストレージ アカウント" を検索します。** 次に、結果として得られる **[ストレージ アカウント]** ページで、**[作成]** を選択します。
1. **[ストレージ アカウントの作成]** ページで、次の値を入力します。
    - **サブスクリプション**:Azure サブスクリプションを選択します。
    - **リソース グループ**: ご自分で選択した名前を持つ新しいリソース グループを作成します。
    - **ストレージ アカウント名**: 小文字と数字を使用して、ストレージ アカウントの一意の名前を入力します。
    - **リージョン**: 使用可能な場所を選択します。
    - **パフォーマンス**: "標準"**
    - **冗長性**: *"ローカル冗長ストレージ (LRS)"*

1. **[次へ: 詳細]** を選択し、詳細な構成オプションを表示します。 特に、ここでは階層型名前空間を有効にして、Azure Data Lake Storage Gen 2 がサポートされることに注意してください。 このオプションは **<u>未選択</u>** のままにし (後で有効にします)、 **[次へ: ネットワーク]** を選択して、ストレージ アカウントのネットワーク オプションを表示します。
1. **[次へ: データ保護]** を選択し、次に **[回復]** セクションで **[論理的な削除を有効にする]** オプションを選択<u>解除</u>します。 これらのオプションでは、後の回復のために削除されたファイルが保持されますが、後で階層型名前空間を有効にするときに問題が発生する可能性があります。
1. 既定の設定を変更せずに残りの **[次へ]** ページに進んでから、 **[確認]** ページで選択内容が検証されるのを待ち、 **[作成]** を選択して Azure Storage アカウントを作成します。
1. デプロイが完了するまで待ちます。 次に、デプロイされたリソースに移動します。

## BLOB ストレージを探索する

新しい Azure Storage アカウントを作成したので、BLOB データ用のコンテナーを作成できます。

1. `https://aka.ms/product1.json` から [product1.json](https://aka.ms/product1.json?azure-portal=true) JSON ファイルをダウンロードし、コンピューターに保存します (任意のフォルダーに保存できます。後で BLOB ストレージにアップロードします)。

    *JSON ファイルがブラウザーに表示される場合は、ページを **product1.json** として保存します。*

1. ストレージ コンテナーの Azure portal ページの左側にある **[データ ストレージ]** セクションで、**[コンテナー]** を選択します。
1. **[コンテナー]** ページで **[&#65291; コンテナー]** を選択し、パブリック アクセス レベルが **[非公開 (匿名アクセスなし)]** の **data** という名前の新しいコンテナーを追加します。
1. **data** コンテナーが作成された後、それが **[コンテナー]** ページに一覧表示されているのを確認します。
1. 左側のペインの上部のセクションで、 **[ストレージ ブラウザー]** を選択します。 このページには、ストレージ アカウント内のデータを処理するために使用できるブラウザーベースのインターフェイスが表示されます。
1. [ストレージ ブラウザー] ページで **[BLOB コンテナー]** を選択し、**data** コンテナーが一覧表示されていることを確認します。
1. **data** コンテナーを選択します。空である点に注意してください。
1. **[&#65291; ディレクトリの追加]** を選択し、**products** という名前の新しいディレクトリを作成する前にフォルダーに関する情報を読みます。
1. ストレージ ブラウザーで、作成した **products** フォルダーの内容が現在のビューに表示されていることを確認します。ページの上部にある "階層リンク" に **BLOB コンテナー > data > products** のパスが反映されているのを確認します。
1. 階層リンクで、**data** を選択して **data** コンテナーに切り替えます。**products** という名前のフォルダーは含まれ<u>ない</u>ので注意してください。

    BLOB ストレージ内のフォルダーは仮想であり、BLOB のパスの一部としてのみ存在します。 **products** フォルダーには BLOB が含まれていなかったので、実際に存在しません。

1. **[&#10514; アップロード]** ボタンを使用して、 **[BLOB のアップロード]** パネルを開きます。
1. **[BLOB のアップロード]** パネルで、以前にローカル コンピューターに保存した **product1.json** ファイルを選択します。 次に、**[詳細]** セクションの **[フォルダーにアップロード]** ボックスに **product_data** と入力し、**[アップロード]** ボタンを選択します。
1. **[BLOB アップロード]** パネルが開いている場合は閉じ、データ コンテナーに **product_data 仮想フォルダー** が作成されたことを確認します。
1. **product_data** フォルダーを選択し、アップロードした **product1.json** BLOB が含まれているか確認します。
1. 左側の **[データ ストレージ]** セクションで、**[コンテナー]** を選択します。
1. **data** コンテナーを開き、作成した **product_data** が一覧表示されていることを確認します。
1. フォルダーの右端の **[&#x2027;&#x2027;&#x2027;]** アイコンを選択します。オプションが表示されないことにご注意ください。 フラット型名前空間 BLOB コンテナー内のフォルダーは仮想であり、管理できません。
1. **data** ページの右上にある **X** アイコンを使用してページを閉じ、**[コンテナー]** ページに戻ります。

## Azure Data Lake Storage Gen2 を確認する

Azure Data Lake Store Gen2 のサポートを使用すると、階層フォルダーを使用して BLOB へのアクセスを整理および管理できます。 また、Azure BLOB ストレージを使用して、一般的なビッグ データ分析プラットフォーム用の分散ファイル システムをホストできます。

1. `https://aka.ms/product2.json` から [product2.json](https://aka.ms/product2.json?azure-portal=true) JSON ファイルをダウンロードし、コンピューターの以前 ** product1.json** をダウンロードしたのと同じフォルダーに保存します。後で BLOB ストレージにアップロードします。
1. ストレージ アカウントの Azure portal ページの左側にある **[設定]** セクションまで下にスクロールし、 **[Data Lake Gen2 のアップグレード]** を選択します。
1. **[Data Lake Gen2 のアップグレード]** ページで、階層型名前空間を有効にし、Azure Data Lake Storage Gen 2 をサポートするようにストレージ アカウントをアップグレードする各手順を展開して完了します。 これには時間がかかる場合があります。
1. アップグレードが完了したら、左側のペインの上部セクションで **[ストレージ ブラウザー]** を選択し、**data** BLOB コンテナーのルートに戻ります。これには引き続き **product_data** フォルダーが含まれます。
1. **product_data** フォルダーを選択し、前にアップロードした **product1.json** ファイルがまだ含まれているか確認します。
1. **[&#10514; アップロード]** ボタンを使用して、 **[BLOB のアップロード]** パネルを開きます。
1. **[BLOB のアップロード]** パネルで、ローカル コンピューターに保存した **product2.json** ファイルを選択します。 次に、**[アップロード]** ボタンを選択します。
1. **[BLOB のアップロード]** パネルが開いている場合は閉じ、**product_data** フォルダーに **product2.json** ファイルが含まれているのを確認します。
1. 左側の **[データ ストレージ]** セクションで、**[コンテナー]** を選択します。
1. **data** コンテナーを開き、作成した **product_data** が一覧表示されていることを確認します。
1. フォルダーの右側にある **[&#x2027;&#x2027;&#x2027;]** アイコンを選択し、階層型名前空間を有効にすると、フォルダー レベルで構成タスクを実行できることにご注意ください。これにはフォルダー名の変更やアクセス許可の設定を含みます。
1. **data** ページの右上にある **X** アイコンを使用してページを閉じ、**[コンテナー]** ページに戻ります。

## Azure Files について調べる

Azure Files は、クラウドベースのファイル共有を作成する方法を提供します。

1. ストレージ コンテナーの Azure portal ページの左側にある **[データ ストレージ]** セクションで、**[ファイル共有]** を選択します。
1. [ファイル共有] ページで **[&#65291; ファイル共有]** を選択し、**トランザクション最適化**レベルを使用して **files** という名前の新しいファイル共有を追加します。
1. **[ファイル共有]** で、新しい **files** ファイル共有を開きます。
1. ページの上部で、**[接続]** を選択します。 次に、**[接続]** ペインに、クライアント コンピューターから共有フォルダーに接続するために実行できるスクリプトを含む一般的なオペレーティング システム (Windows、Linux、macOS) のタブがあることに注意してください。
1. **[接続]** ペインを閉じ、次に **files** ファイル ページを閉じて、Azure ストレージ アカウントの **[ファイル共有]** ページに戻ります。

## Azure Tables を確認する

Azure テーブルは、データ値の格納を必要としても、リレーショナル データベースの完全な機能と構造を必要としないアプリケーションに、キーと値ストアを提供します。

1. ストレージ コンテナーの Azure portal ページの左側にある **[データ ストレージ]** セクションで、**[テーブル]** を選択します。
1. **[テーブル]** ページで、 **[&#65291; テーブル]** を選択し、**products** という名前の新しいテーブルを作成します。
1. **products** テーブルが作成されたら、左側のペインの上部にある **[ストレージ ブラウザー]** を選択します。
1. ストレージ エクスプローラーで、**[テーブル]** を選択し、**products** テーブルが表示されていることを確認します。
1. **products** テーブルを選択します。
1. **product** ページで、 **[&#65291; エンティティの追加]** を選択します。
1. **[エンティティの追加]** パネルで、次のキー値を入力します。
    - **PartitionKey**: 1
    - **RowKey**: 1
1. **[プロパティの追加]** を選択し、次の値を使用して新しいプロパティを作成します。

    |プロパティ名 | Type | 値 |
    | ------------ | ---- | ----- |
    | 名前 | String | ウィジェット |

1. 次の値を持つ 2 番目のプロパティを追加します。

    |プロパティ名 | Type | 値 |
    | ------------ | ---- | ----- |
    | Price | Double | 2.99 |

1. **[挿入]** を選択して、新しいエンティティの行をテーブルに挿入します。
1. ストレージ ブラウザーで、**products** テーブルに行が追加されていること、および行が最後に変更された日時を示す **Timestamp** 列が作成されていることを確認します。
1. 次のプロパティを使用して、**products** テーブルに別のエンティティを追加します。

    |プロパティ名 | Type | 値 |
    | ------------ | ---- | ----- |
    | パーティション キー | String | 1 |
    | 行キー | 文字列 | 2 |
    | 名前 | String | Kniknak |
    | Price | Double | 1.99 |
    | Discontinued | Boolean | true |

1. 新しいエンティティを挿入した後、生産が中止された製品を含む行がテーブルに表示されていることを確認します。

    ストレージ ブラウザーのインターフェイスを使用して、テーブルにデータを手動で入力しました。 実際のシナリオでは、アプリケーション開発者は Azure Storage Table API を使用して、テーブルに対して値の読み取りと書き込みを行うアプリケーションを作成できます。これにより、NoSQL ストレージのコスト効率と拡張性に優れたソリューションになります。

> **ヒント**: Azure Storage の調査が完了した場合は、この演習で作成したリソース グループを削除してください。
