---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053099"
---
# <a name="delayed-stream"></a>delayed-stream

ストリームからイベントを処理する準備ができるまでバッファー処理します。

## <a name="installation"></a>インストール

``` bash
npm install delayed-stream
```

## <a name="usage"></a>使用

次の例は、応答を 1,000 ms 遅らせる http エコー サーバーを記述する方法を示しています。

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

`Stream#pipe` を使用していない場合は、`delayedStream.resume()` を呼び出してバッファーイベントを手動で解放することもできます。

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>実装

このメタ ストリームを適切に使用するために、実装について知っておくべきいくつかの点を次に示します。

### <a name="event-buffering--proxying"></a>イベント バッファーリング/プロキシ

`source` ストリームのすべてのイベントは、`source.emit` メソッドを上書きするとハイジャックされます。 ノードがキャッチオール イベント リスナーを実装するまでは、これが唯一の方法です。

ただし、遅延ストリームは、遅延ストリームをまだ解放していないかどうかに関わらず、`source` でキャプチャしたすべてのイベントを引き続き出力します。

作成時に、遅延ストリームは、すべての `source` イベントをキャプチャし、内部イベント バッファーに格納します。 `delayedStream.release()` が呼び出されると、すべてのバッファーされたイベントが `delayedStream` に出力され、イベント バッファーがクリアされます。 その後、遅延ストリームは、基になるソースのプロキシとして機能するだけです。

### <a name="error-handling"></a>エラー処理

`source` のエラー イベントは、他のイベントと同様にバッファー処理またはプロキシ処理されます。
ただし、`delayedStream.create` が no-op `'error'` リスナーを `source` にアタッチします。 この方法では、2 つの場所ではなく、`delayedStream` オブジェクトのエラーのみを処理する必要があります。

### <a name="buffer-limits"></a>バッファー制限

delayed-stream は、バッファー処理されるデータの量を制限するために使用できる `maxDataSize` プロパティを提供します。 `source.pause()` に反応しない不適切な `source` ストリームからユーザーを保護するために、この機能は既定で有効になっています。

## <a name="api"></a>API

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

新しい `delayedStream` を返します。 使用できるオプションは次のとおりです。

* `pauseStream`
* `maxDataSize`

これらのプロパティの説明については、以下を参照してください。

### <a name="delayedstreamsource"></a>delayedStream.source

このオブジェクトによって管理される `source` ストリーム。 これは、`delayedStream` を受け渡しする場合に、`source` オブジェクトのプロパティに引き続きアクセスする場合に便利です。

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

`DelayedStream.create()` を呼び出すときに基になる `source` を一時停止するかどうか。 後でこのプロパティを変更しても効果はありません。

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

`error` を出力する前にバッファー処理するデータの量。

基になるソースが `Buffer` オブジェクトを出力している場合は、`maxDataSize` はバイトを参照します。

基になるソースが JavaScript 文字列を出力している場合、サイズは文字を参照します。

実行している内容がわかっている場合は、このプロパティを `Infinity` に設定してこの機能を無効にすることができます。 実行時にこのプロパティを変更することもできます。

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

これまでにバッファー処理されたデータの量。

### <a name="delayedstreamreadable"></a>delayedStream.readable

`source.readable` の値を返す ECMA5 ゲッター。

### <a name="delayedstreamresume"></a>delayedStream.resume()

これまでに `delayedStream` が解放されていない場合は、`delayedStream.release()` が呼び出されます。

どちらの場合も、`source.resume()` が呼び出されます。

### <a name="delayedstreampause"></a>delayedStream.pause()

`source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

`delayedStream.resume()` を呼び出して引数を `source.pipe` にプロキシします。

### <a name="delayedstreamrelease"></a>delayedStream.release()

これまでにバッファー処理されたすべてのイベントを出力およびクリアします。 これは、基になるソースを再開しないので、代わりに `delayedStream.resume()` を使用します。

## <a name="license"></a>ライセンス

delayed-stream は、MIT ライセンスにより許諾されています。
