---
ms.openlocfilehash: 0e4384a6edea7b3a580ffa5b32236b7f8b251834
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052336"
---
# <a name="combined-stream"></a>combined-stream

他の複数のストリームを 1 つずつ出力するストリーム。

**NB** 現在 `combined-stream` は streams バージョン 1 でのみ機能します。 このライブラリを streams バージョン 2 に切り替える作業が進行中です。 どんな手助けも大歓迎です。 :)それまでの間は、`combined-stream` と多かれ少なかれ互換性があり streams2 をサポートする他のライブラリを調べることができます。

- [combined-stream2](https://www.npmjs.com/package/combined-stream2): combined-stream モジュールに対するドロップインの streams2 互換の置換。

- [multistream](https://www.npmjs.com/package/multistream): 他の複数のストリームを 1 つずつ出力するストリーム。

## <a name="installation"></a>インストール

``` bash
npm install combined-stream
```

## <a name="usage"></a>使用

combined-stream を使用して 2 つのファイルを 1 つに結合する方法を示す簡単な例を次に示します。

``` javascript
var CombinedStream = require('combined-stream');
var fs = require('fs');

var combinedStream = CombinedStream.create();
combinedStream.append(fs.createReadStream('file1.txt'));
combinedStream.append(fs.createReadStream('file2.txt'));

combinedStream.pipe(fs.createWriteStream('combined.txt'));
```

上の例は問題なく機能しますが、必要になるまですべてのソース ストリームを一時停止します。 そのようにしたくない場合は、`pauseStreams` を `false` に設定できます。

``` javascript
var CombinedStream = require('combined-stream');
var fs = require('fs');

var combinedStream = CombinedStream.create({pauseStreams: false});
combinedStream.append(fs.createReadStream('file1.txt'));
combinedStream.append(fs.createReadStream('file2.txt'));

combinedStream.pipe(fs.createWriteStream('combined.txt'));
```

ただし、すべてのソース ストリームがまだ揃っていない場合や、それらにリソース (ファイル記述子、メモリなど) をすぐに割り当てたくない場合はどうすればよいでしょうか。
その場合は、`next()` 関数を呼び出すことによってストリームを提供するコールバックを単に提供できます。

``` javascript
var CombinedStream = require('combined-stream');
var fs = require('fs');

var combinedStream = CombinedStream.create();
combinedStream.append(function(next) {
  next(fs.createReadStream('file1.txt'));
});
combinedStream.append(function(next) {
  next(fs.createReadStream('file2.txt'));
});

combinedStream.pipe(fs.createWriteStream('combined.txt'));
```

## <a name="api"></a>API

### <a name="combinedstreamcreateoptions"></a>CombinedStream.create([options])

結合された新しいストリーム オブジェクトを返します。 使用できるオプションは次のとおりです。

* `maxDataSize`
* `pauseStreams`

それらのオプションの効果については以下で説明します。

### <a name="combinedstreampausestreams--true"></a>combinedStream.pauseStreams = `true`

基になっているストリームにバック プレッシャーをかけるかどうか。 `false` に設定すると、基になっているストリームは一時停止されません。 `true` に設定すると、基になっているストリームは、追加された直後と、`delayedStream.pipe()` が調整を必要としている場合に、一時停止されます。

### <a name="combinedstreammaxdatasize--2--1024--1024"></a>combinedStream.maxDataSize = `2 * 1024 * 1024`

すべてのソース ストリームについてバッファーに格納する最大バイト数 (または文字数)。
この値を超えた場合、`combinedStream` は `'error'` イベントを出力します。

### <a name="combinedstreamdatasize--0"></a>combinedStream.dataSize = `0`

`combinedStream` によって現在バッファーに格納されているバイト数 (または文字数)。

### <a name="combinedstreamappendstream"></a>combinedStream.append(stream)

指定された `stream` を combinedStream オブジェクトに追加します。 `pauseStreams` が true に設定されている場合、このストリームはすぐに一時停止されます。

`streams` は、`next` という名前の 1 つのパラメーターを受け取る関数でもかまいません。 `next` は、`next` ストリームを提供するために呼び出す必要がある関数です。上の例を参照してください。

`stream` を追加する方法に関係なく、combined-stream は常に `'error'` リスナーをそれにアタッチするため、手動でそれを行う必要はありません。

特殊なケース: `stream` は String または Buffer にすることもできます。

### <a name="combinedstreamwritedata"></a>combinedStream.write(data)

これは呼び出さないでください。`combinedStream` によって、追加されたストリームのそれ自体へのパイプ処理は自動的に行われます。

### <a name="combinedstreamresume"></a>combinedStream.resume()

`combinedStream` によりそれが管理するストリームのドレインが開始されます。 この関数はべき等であり、通常、現在ドレインされているストリームに移動するたびに、`'resume'` イベントも生成されます。

### <a name="combinedstreampause"></a>combinedStream.pause();

`combinedStream.pauseStreams` が `false` に設定されている場合、これは何も行いません。
それ以外の場合は、`'pause'` イベントが生成され、これは現在ドレインされているストリームに送られるため、それを使用してバック プレッシャーを適用できます。

### <a name="combinedstreamend"></a>combinedStream.end();

`combinedStream.writable` を false に設定し、`'end'` イベントを生成して、キューからすべてのストリームを削除します。

### <a name="combinedstreamdestroy"></a>combinedStream.destroy();

`combinedStream.end()` と同じですが、`'end'` の代わりに `'close'` イベントを生成します。

## <a name="license"></a>ライセンス

combined-stream は、MIT ライセンスにより許諾されています。
