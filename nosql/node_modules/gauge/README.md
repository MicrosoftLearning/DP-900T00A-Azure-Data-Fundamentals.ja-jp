---
ms.openlocfilehash: 81fd1455668c9343defe69cbbbff10d48b1f97ef
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052867"
---
<a name="gauge"></a>gauge
=====

ほぼステートレスなターミナル ベースの水平ゲージまたは進行状況バー。

```javascript
var Gauge = require("gauge")

var gauge = new Gauge()

gauge.show("test", 0.20)

gauge.pulse("this")

gauge.hide()
```

![](gauge-demo.gif)


### <a name="changes-from-1x"></a>1\.x からの変更点

gauge 2.x は破壊的リリースです。以前にこのモジュールのユーザーであった場合、変更点の詳細については[変更ログ]を参照してください。

[変更ログ]: CHANGELOG.md

### <a name="the-gauge-class"></a>GAUGE クラス

これはモジュールとの一般的なインターフェイスです。ステータス情報を表示するための優れたファイア アンド フォーゲット インターフェイスを提供します。

```
var Gauge = require("gauge")

var gauge = new Gauge([stream], [options])
```

* **stream** – " *(省略可能、既定値 STDERR)* " 進行状況バーの更新情報が書き込まれるストリーム。  ゲージはバックプレッシャを受け入れ、指示があった場合はほとんどの書き込みを一時停止します。
* **options** – " *(省略可能)* " オプション オブジェクト。

新しいゲージを構築します。 ゲージは 1 行に描画され、**stream** が tty ではなく、tty が明示的に指定されていない場合は描画されません。

**stream** がターミナルの場合、または **tty** を **options** に渡した場合は、ターミナルのサイズ変更が検出され、適切に再描画されます。  これを行うには、tty で `resize` イベントを監視します。  (2.5.0 より前のバージョンの Node でバグを回避するには、tty が stderr である場合は stdout で監視します。)ウィンドウを拡大するサイズ変更は問題ありませんが、ウィンドウを縮小すると、常に多少の問題が発生します。

**重要:** 以前に tty 以外のストリームを渡していたが、引き続き出力 (`ansi` モジュールによってラップされたストリームなど) が必要な場合は、以下の **tty** オプションを渡す必要があります。`gauge` は、ターミナルのサイズ変更やターミナル幅の検出などを行うために、基になる tty にアクセスする必要があります。

**options** オブジェクトには次のプロパティを指定できます。これらはすべて省略可能です。

* **updateInterval**: ゲージの更新情報を描画する頻度 (ミリ秒単位)。
* **fixedFramerate**: node 0.8 では既定値は false、その他すべての場合は true です。  これが true の場合は、`updateInterval` ミリ秒ごとに 1 回トリガーが発生するタイマーが作成されます。false の場合は、更新情報は発生するとすぐに出力されますが、`updateInterval` よりも頻繁な更新は無視されます。  0\.8 でこれが true に設定されていない理由は、タイマーの `unref` ができず、プログラムの終了が停止するためです。この機能を 0.8 で使用する場合は、プログラムが終了することを予想する前に必ず `gauge.disable()` を呼び出してください。
* **themes**: 使用するテーマを選択するときに使用するテーマセット。 既定値は `gauge/themes` です。詳細については、[themes] のドキュメントを参照してください。
* **theme**: 使用するテーマを選択します。次の場合があります。
  * テーマ オブジェクト。その場合、**themes** は使用されません。
  * 現在の *themes* オブジェクトで検索されるテーマの名前。
  * `hasUnicode`、`hasColor`、または `platform` のいずれかのキーを設定した構成オブジェクト。既定のテーマ選択を行うときに推測をオーバーライドするために使用されます。

  テーマが選択されなかった場合は、OS、色のサポート、Unicode のサポートについての推測の組み合わせを使用して、既定値が選択されます。
* **template**: ゲージの外観を記述します。  既定値は npm で使用されるものです。  詳細な[ドキュメント]は、このドキュメントの後半にあります。
* **hideCursor**: 既定値は true です。  true の場合、ゲージが表示されている間、カーソルは非表示になります。
* **tty**: 最終的な書き込み先となる tty。  既定値は **stream** と同じです。  これは、ターミナルの幅を検出し、サイズを変更するために使用されます。 使用される幅は `tty.columns - 1` です。 使用可能な tty がない場合は、幅 `79` が想定されます。
* **enabled**:`tty` が TTY の場合は既定値の true、それ以外の場合は false です。  true の場合、ゲージは有効になった状態で開始されます。  無効にした場合、すべての更新コマンドは無視され、`.enable()` を呼び出すまでゲージは出力されません。
* **Plumbing**: ゲージを出力用に実際に生成するために使用するクラス。  既定値は `require('gauge/plumbing')` であり、通常はこれをオーバーライドする必要はありません。
* **cleanupOnExit**: 既定値は true です。 通常は、Ctrl キーを押しながら C キーを押した場合や予期せず終了した場合でも、プロセスが終了したときにカーソルがオンに戻り、進行状況バーが消去されるように、終了ハンドラーを登録します。 これを無効にすることができます。そうすると終了ハンドラーは登録されません。

[has-unicode]: https://www.npmjs.com/package/has-unicode
[themes]: #themes
[ドキュメント]: #templates

#### `gauge.show(section | status, [completed])`

最初の引数は、セクション、進行状況に現在影響しているものの名前、または **section**、**subsection**、 & **completed** などのキーを持つ (またはカスタム テンプレートに型が含まれているその他の) オブジェクトのいずれかです。  これらのいずれも更新または設定しない場合は、`null` を渡すことができます。これは無視されます。

2 番目の引数は、0 から 1 までの値として表した完了率です。
それがなければ、完了しても更新されません。 また、最初の引数で status オブジェクトの一部として完了の状態を渡すこともできます。 それと completed 引数の両方が渡された場合は、completed 引数が優先されます。

#### `gauge.hide([cb])`

ターミナルからゲージを削除します。  必要に応じて、IO が発生する機会があった後 (現在、これは `setImmediate` がコールバックされた後を意味します)、`cb` をコールバックします。

あるファイルハンドルで進行状況バーを一時停止して別のファイルハンドルに出力する場合、これが重要であることがわかります。それ以外の場合 (出力の大きさが十分な場合)、node では、進行状況バーのファイルハンドルに "進行状況バーの終了" ビットが出力され、他のものは別のファイルハンドルに出力されます。 これらのインターリーブが発生すると、一部のターミナルで破損が発生する可能性があります。

#### `gauge.pulse([subsection])`

* **subsection** – " *(省略可能)* " このパルスをトリガーした特定のもの

ゲージ内のスピナーを回転させて出力を表示します。  **subsection** が含まれている場合、それは `gauge.show` に渡された最後の名前と組み合わされます。

#### `gauge.disable()`

ゲージを非表示にし、`show` または `pulse` へのそれ以降の呼び出しを無視します。

#### `gauge.enable()`

ゲージを表示し、`show` または `pulse` が呼び出されたときに更新を再開します。

#### `gauge.isEnabled()`

ゲージが有効である場合は、true を返します。

#### `gauge.setThemeset(themes)`

テーマセットを変更してテーマを選択します。 コンストラクターで使用される `themes` オプションと同じです。 このテーマセットからテーマが再選択されます。

#### `gauge.setTheme(theme)`

アクティブなテーマを変更すると、次の show または pulse で表示されます。 これは以下のマシンで行えます。

* テーマ オブジェクト。その場合、**themes** は使用されません。
* 現在の *themes* オブジェクトで検索されるテーマの名前。
* `hasUnicode`、`hasColor`、または `platform` のいずれかのキーを設定した構成オブジェクト。既定のテーマ選択を行うときに推測をオーバーライドするために使用されます。

テーマが選択されなかった場合は、OS、色のサポート、Unicode のサポートについての推測の組み合わせを使用して、既定値が選択されます。

#### `gauge.setTemplate(template)`

アクティブなテンプレートを変更すると、次の show または pulse で表示されます

### <a name="tracking-completion"></a>完了の追跡

完了を追跡する必要がある対象が複数ある場合は、関連する [are-we-there-yet] が役に立つ場合があります。  その `change` イベントを `show` メソッドに関連付けると、従来の進行状況バー インターフェイスが得られます。

[are-we-there-yet]: https://www.npmjs.com/package/are-we-there-yet

### <a name="themes"></a>テーマ

```
var themes = require('gauge/themes')

// fetch the default color unicode theme for this platform
var ourTheme = themes({hasUnicode: true, hasColor: true})

// fetch the default non-color unicode theme for osx
var ourTheme = themes({hasUnicode: true, hasColor: false, platform: 'darwin'})

// create a new theme based on the color ascii theme for this platform
// that brackets the progress bar with arrows
var ourTheme = themes.newTheme(theme(hasUnicode: false, hasColor: true}), {
  preProgressbar: '→',
  postProgressbar: '←'
})
```

`gauge/themes` によって返されるオブジェクトは、`ThemeSet` クラスのインスタンスです。

```
var ThemeSet = require('gauge/theme-set')
var themes = new ThemeSet()
// or
var themes = require('gauge/themes')
var mythemes = themes.newThemeset() // creates a new themeset based on the default themes
```

#### <a name="themesopts"></a>themes(opts)
#### <a name="themesgetdefaultopts"></a>themes.getDefault(opts)

テーマ オブジェクトは、プラットフォーム、Unicode、色のサポートに基づいて既定のテーマをフェッチする関数です。

オプションは、次のプロパティを持つオブジェクトです。

* **hasUnicode** - true の場合は、Unicode テーマをフェッチします。使用可能な Unicode テーマがない場合は、Unicode 以外のテーマが使用されます。
* **hasColor** - true の場合は、カラー テーマをフェッチします。使用可能なカラー テーマがない場合は、カラーでないテーマが使用されます。
* **platform** (省略可能) - 既定値は `process.platform` です。  使用可能なプラットフォームの一致がない場合は、代わりに `fallback` が使用されます。

互換性のあるテーマが見つからない場合は、`code` が `EMISSINGTHEME` のエラーがスローされます。

#### <a name="themesaddthemethemename-themeobj"></a>themes.addTheme(themeName, themeObj)
#### <a name="themesaddthemethemename-parenttheme-newtheme"></a>themes.addTheme(themeName, [parentTheme], newTheme)

テーマセットに名前付きテーマを追加します。  `themes.newTheme` によって返されるテーマ オブジェクト、`themes.newTheme` に渡す引数のどちらでも渡すことができます。

#### <a name="themesgetthemenames"></a>themes.getThemeNames()

このテーマセットにあるすべてのテーマの名前の一覧を返します。 `themes.getTheme(…)` での使用に適しています。

#### <a name="themesgetthemename"></a>themes.getTheme(name)

このテーマ セットから `name` という名前のテーマ オブジェクトを返します。

`name` がこのテーマセットに存在しない場合は、`code` が `EMISSINGTHEME` のエラーがスローされます。

#### <a name="themessetdefaultopts-themename"></a>themes.setDefault([opts], themeName)

`opts` は、次のプロパティを持つオブジェクトです。

* **platform** - 既定値は `'fallback'` です。  テーマがプラットフォーム固有の場合は、`process.platform` からのプラットフォーム (例: `win32`、`darwin` など) を使用して、ここで指定します。
* **hasUnicode** - 既定値は `false` です。 テーマで Unicode を使用する場合は、これを true に設定する必要があります。
* **hasColor** - 既定値は `false` です。  テーマで色を使用する場合は、これを true に設定する必要があります。

`themeName` は、この `opts` のセットに使用する (`addTheme` に指定した) テーマの名前です。

#### <a name="themesnewthemeparenttheme-newtheme"></a>themes.newTheme([parentTheme,] newTheme)

`parentTheme` に基づいて新しいテーマ オブジェクトを作成します。  `parentTheme` が指定されていない場合は、アクティビティ インジケーター (スピナー) と進行状況バーをレンダリングするための関数を定義する最小限の parentTheme が定義されます。 (このフォールバックの親は `gauge/base-theme` で定義されます。)

newTheme はベア オブジェクトである必要があります。まず、既定のテーマで定義されるプロパティについて説明します。

* **preProgressbar** - 進行状況バーが表示される場合、進行状況バーの前に表示されます。
* **postProgressbar** - 進行状況バーが表示される場合、進行状況バーの後に表示されます。
* **progressBarTheme** - 進行状況バー レンダラーに渡されるサブテーマ。これは、進行状況バーのこれらのセクションで繰り返す文字列である `complete` および `remaining` プロパティを持つオブジェクトです。
* **activityIndicatorTheme** - アクティビティ インジケーター (スピナー) のテーマ。各文字が異なるステップである文字列、または文字列の配列のいずれかにすることができます。
* **preSubsection** - `subsection` が出力されるときに、それと `section` との区切りとして表示されます。

より一般的には、テンプレートをレンダリングするときに有効な値となる任意の値をテーマに設定できます。 テーマのプロパティは、名前がテンプレート内の型と一致する場合に使用されます。 可能な値は次のとおりです。

* **文字列と数値** - そのまま挿入されます
* **function (values, theme, width)** - 出力に必要なものを返します。
  *values* は `gauge.show` を介して提供される値を持つオブジェクトであり、*theme* は、この項目 (下記参照) またはこのテーマ オブジェクトに固有のテーマです。*width* は、結果の幅を示す文字数です。

特殊なプレフィックスがいくつかあります。

* **pre** - プロパティが表示される場合、その前に表示されます。
* **post** - プロパティが表示される場合、その後に表示されます。

また、特別なサフィックスが 1 つあります。

* **Theme** - その値はテーマとして関数型の項目に渡されます。

#### <a name="themesaddtoallthemestheme"></a>themes.addToAllThemes(theme)

これは、現在定義されているすべてのテーマに `theme` を *mix-in* します。 また、それはこのテーマセットの既定の親テーマにも追加されるため、このテーマセットに追加した今後のテーマは、既定で `theme` から値を取得します。

#### <a name="themesnewthemeset"></a>themes.newThemeset()

現在のテーマセットを新しいテーマセットにコピーします。  これにより、あるテーマセットを別のテーマセットから簡単に継承できます。

### <a name="templates"></a>テンプレート

テンプレートは、評価された後にゲージ行に変換されるオブジェクトと文字列の配列です。  既定のテンプレートは次のとおりです。

```javascript
[
    {type: 'progressbar', length: 20},
    {type: 'activityIndicator', kerning: 1, length: 1},
    {type: 'section', kerning: 1, default: ''},
    {type: 'subsection', kerning: 1, default: ''}
]
```

さまざまなテンプレート要素は、**プレーン文字列** とすることも (その場合は出力に逐語的に挿入される)、次のプロパティを持つオブジェクトとすることもできます。

* *type* は、次のいずれかと、`gauge.show` に渡す任意のキーに加えて、カスタム テーマに含まれている任意のキーを指定できます。
  * `section` – 現在の処理対象である項目。
  * `subsection` – その項目のどのコンポーネントが現在動作しているか。
  * `activityIndicator` – アクティブなテーマの `activityIndicatorTheme` を使用してスピナーを表示します。
  * `progressbar` – アクティブなテーマの `progressbarTheme` を使用して現在の `completed` を表す進行状況バー。
* *kerning* – この項目が表示される場合、この項目と他の項目の間に必要なスペースの数。
* *maxLength* – この要素の最大長。 値がこれより長い場合は、切り捨てられます。
* *minLength* – この要素の最小長。 値がこれより短い場合は、*align* 値に従って埋め込みが行われます。
* *align* – (既定値: left) 使用できる値は "left"、"right"、"center" です。 ワード プロセッサで想定されるように動作します。
* *length* – *minLength* と *maxLength* の両方に 1 つの値を提供します。 *length* と *minLength (または *maxLength*) の両方が指定されている場合は、後者が優先されます。
* *value* – このテンプレート項目に使用するリテラル値。
* *default* – 別の値が渡されなかった場合に、このテンプレート項目に使用する既定値。

### <a name="plumbing"></a>配管 (PLUMBING)

これは非常に単純で、何も想定せず、ゲージが通常のインターフェイスを実装するために使用する魔法の内部処理を行うわけではありません。

```
var Plumbing = require('gauge/plumbing')
var gauge = new Plumbing(theme, template, width)
```

* **theme**: 使用するテーマ。
* **template**: 使用するテンプレート。
* **width**: ゲージの幅

#### `gauge.setTheme(theme)`

アクティブなテーマを変更します。

#### `gauge.setTemplate(template)`

アクティブなテンプレートを変更します。

#### `gauge.setWidth(width)`

レンダリングする幅を変更します。

#### `gauge.hide()`

進行状況バーを非表示にするために必要な文字列を返します

#### `gauge.hideCursor()`

カーソルを非表示にする文字列を返します。

#### `gauge.showCursor()`

カーソルを表示する文字列を返します。

#### `gauge.show(status)`

値に `status` を使用して、指定されたテンプレートとテーマをレンダリングし、ゲージを更新するための出力に適した文字列を返します。
