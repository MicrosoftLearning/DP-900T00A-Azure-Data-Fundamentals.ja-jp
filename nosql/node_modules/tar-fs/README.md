---
ms.openlocfilehash: 841a4ef811cc186a2302309fbbc4a380d1ba5cbd
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050947"
---
# <a name="tar-fs"></a>tar-fs

[tar-stream](https://github.com/mafintosh/tar-stream) のファイルシステム バインド。

```
npm install tar-fs
```

[![ビルドの状態](https://secure.travis-ci.org/mafintosh/tar-fs.png)](http://travis-ci.org/mafintosh/tar-fs)

## <a name="usage"></a>使用

tar-fs を使用すると、ディレクトリを tarball にパックし、tarball をディレクトリに抽出できます。

gunzip は行われないため、これで `.tar.gz` を抽出する場合は、これに加えて [gunzip-maybe](https://github.com/mafintosh/gunzip-maybe) のようなものを使用する必要があります。

``` js
var tar = require('tar-fs')
var fs = require('fs')

// packing a directory
tar.pack('./my-directory').pipe(fs.createWriteStream('my-tarball.tar'))

// extracting a directory
fs.createReadStream('my-other-tarball.tar').pipe(tar.extract('./my-other-directory'))
```

パック時または抽出時にさまざまなファイルを無視するには、オプションに ignore 関数を追加します。 `ignore` は、`filter` のエイリアスでもあります。 また、抽出中に ignore を使用すると、`header` が表示されます。
そうすることで、メタデータでフィルター処理することもできます。

``` js
var pack = tar.pack('./my-directory', {
  ignore: function(name) {
    return path.extname(name) === '.bin' // ignore .bin files when packing
  }
})

var extract = tar.extract('./my-other-directory', {
  ignore: function(name) {
    return path.extname(name) === '.bin' // ignore .bin files inside the tarball when extracing
  }
})

var extractFilesDirs = tar.extract('./my-other-other-directory', {
  ignore: function(_, header) {
    // pass files & directories, ignore e.g. symlinks
    return header.type !== 'file' && header.type !== 'directory'
  }
})
```

`entries` オプションを使用して、パックするエントリを指定することもできます

```js
var pack = tar.pack('./my-directory', {
  entries: ['file1', 'subdir/file2'] // only the specific entries will be packed
})
```

パックまたは抽出時にヘッダーを変更する場合は、オプションに map 関数を追加します

``` js
var pack = tar.pack('./my-directory', {
  map: function(header) {
    header.name = 'prefixed/'+header.name
    return header
  }
})

var extract = tar.extract('./my-directory', {
  map: function(header) {
    header.name = 'another-prefix/'+header.name
    return header
  }
})
```

同様に、入力/出力ファイル ストリームを変更する場合は、`mapStream` を使用できます

``` js
var pack = tar.pack('./my-directory', {
  mapStream: function(fileStream, header) {
    // NOTE: the returned stream HAS to have the same length as the input stream.
    // If not make sure to update the size in the header passed in here.
    if (path.extname(header.name) === '.js') {
      return fileStream.pipe(someTransform)
    }
    return fileStream;
  }
})

var extract = tar.extract('./my-directory', {
  mapStream: function(fileStream, header) {
    if (path.extname(header.name) === '.js') {
      return fileStream.pipe(someTransform)
    }
    return fileStream;
  }
})
```

抽出されたファイルまたはディレクトリに対応するモードがあるように、`options.fmode` と `options.dmode` を設定します

``` js
var extract = tar.extract('./my-directory', {
  dmode: parseInt(555, 8), // all dirs should be readable
  fmode: parseInt(444, 8) // all files should be readable
})
```

*nix/windows 間で tarball をパック/アンパックする場合は、アンパックされたすべてのファイルまたはディレクトリが読み取り可能になるように、`dmode` と `fmode` を使用すると便利です。

または、`options.readable` と `options.writable` (またはいずれか) を設定して、dmode および fmode を読み取り可能/書き込み可能に設定することもできます。

``` js
var extract = tar.extract('./my-directory', {
  readable: true, // all dirs and files should be readable
  writable: true, // all dirs and files should be writable
})
```

サポートされていないエントリの種類 (デバイス ファイルなど) によるエラーを無視する場合は、`options.strict` を `false` に設定します

シンボリック リンクを逆参照するには (リンク自体ではなくシンボリック リンクの内容をパックする)、`options.dereference` を `true` に設定します。

## <a name="copy-a-directory"></a>ディレクトリをコピーする

アクセス許可と mtime をそのままにしてディレクトリをコピーするのは簡単です

``` js
tar.pack('source-directory').pipe(tar.extract('dest-directory'))
```

## <a name="interaction-with-tar-stream"></a>[`tar-stream`](https://github.com/mafintosh/tar-stream) との対話

`finalize: false` と `finish` フックを使用してパック ストリームを開いたままにし ([`tar-stream#pack`](https://github.com/mafintosh/tar-stream#packing) を参照)、`pack` を使用して既存のパック ストリームを渡します。

``` js
var mypack = tar.pack('./my-directory', {
  finalize: false,
  finish: function(sameAsMypack) {
    mypack.entry({name: 'generated-file.txt'}, "hello")
    tar.pack('./other-directory', {
      pack: sameAsMypack
    })
  }
})
```


## <a name="performance"></a>パフォーマンス

2496 個のディレクトリと 2398 個のファイルを含む 6.1 GB をパックして抽出すると、Macbook Air で次の結果が得られます。
[ベンチマークはこちらを参照してください](https://gist.github.com/mafintosh/8102201)

* tar-fs:34.261 秒
* [node-tar](https://github.com/isaacs/node-tar):366.123 秒 (または 10 倍遅い)

## <a name="license"></a>ライセンス

MIT
