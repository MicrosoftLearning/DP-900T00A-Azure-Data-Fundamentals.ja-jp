---
ms.openlocfilehash: 34b661fbb1237d51bdab932626d19518225841a0
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052912"
---
<a name="are-we-there-yet"></a>are-we-there-yet
----------------

非同期タスク完了状態の複雑な階層を追跡します。  これは、大規模な再帰ファンアウトの進行状況を記録して報告し、非同期で非常に一般的な型ワークフローを収集する方法を提供することを目的としています。

この完了データに対して行う操作は自分で決めますが、最も一般的なユース ケースは、多くの進行状況バー モジュールのいずれかにフィードすることです。

ほとんどの進行状況バー モジュールには、この基本的なバージョンが含まれていますが、私のニーズはより複雑でした。

<a name="usage"></a>使用
=====

```javascript
var TrackerGroup = require("are-we-there-yet").TrackerGroup

var top = new TrackerGroup("program")

var single = top.newItem("one thing", 100)
single.completeWork(20)

console.log(top.completed()) // 0.2

fs.stat("file", function(er, stat) {
  if (er) throw er  
  var stream = top.newStream("file", stat.size)
  console.log(top.completed()) // now 0.1 as single is 50% of the job and is 20% complete
                              // and 50% * 20% == 10%
  fs.createReadStream("file").pipe(stream).on("data", function (chunk) {
    // do stuff with chunk
  })
  top.on("change", function (name) {
    // called each time a chunk is read from "file"
    // top.completed() will start at 0.1 and fill up to 0.6 as the file is read
  })
})
```

<a name="shared-methods"></a>共有メソッド
==============

* var completed = tracker.completed()

実装済み: `Tracker`、`TrackerGroup`、`TrackerStream`

完了した作業と実行する作業の比率を返します。 0 から 1 の範囲。

* tracker.finish()

実装済み: `Tracker`、`TrackerGroup`

トラッカーを完了としてマークします。 TrackerGroup を使用すると、すべてのコンポーネントが完了としてマークされます。

このトラッカーのすべてのコンポーネントを完了済みとしてマークします。これは、この `tracker.completed()` が 1 になったことを意味します。

これにより、1 つ以上の `change` イベントが生成されます。

<a name="events"></a>イベント
======

すべてのトラッカー オブジェクトは、次の引数を使用して `change` イベントを生成します。

```
function (name, completed, tracker)
```

`name` は、最初にイベントを生成したトラッカーの名前です。またはイベントが存在しなかった場合は、最初にイベントを含んでいたトラッカー グループが含まれています。

`completed` は完了率です (`tracker.completed()` メソッドによって返されます)。

`tracker` は、イベントをリッスンしているトラッカー オブジェクトです。

<a name="trackergroup"></a>TrackerGroup
============

* var tracker = new TrackerGroup(**name**)

  * **name** *(省略可能)* - 更新するコンポーネントに名前がない場合に変更通知で使用される、このトラッカー グループの名前。 既定値は未定義です。

新しい空のトラッカー集計グループを作成します。 これらは、他のトラッカーの完了状態によって完了状態が決定されるトラッカーです。

* tracker.addUnit(**otherTracker**, **weight**)

  * **otherTracker** - 他の are-we-there-yet トラッカー オブジェクトのいずれか
  * **weight** *(省略可能)* - トラッカーに与える重み (既定値は 1)。

**otherTracker** をこの集計グループに追加します。 重みは、このトラッカーが完了するまでの時間を他のユニットに対する割合で決定します。  たとえば、重みが 1 のトラッカーと重みが 2 のトラッカーを追加した場合、2 番目のトラッカーは最初のトラッカーの 2 倍の時間がかかります。  そのため、最初のトラッカーはこのトラッカーの完了の 33% を占め、2 番目は残りの 67% を占めます。

**otherTracker** を返します。

* var subGroup = tracker.newGroup(**name**, **weight**)

上記は次に相当します。

```javascript
  var subGroup = tracker.addUnit(new TrackerGroup(name), weight)
```

* var subItem = tracker.newItem(**name**, **todo**, **weight**)

上記は次に相当します。

```javascript
  var subItem = tracker.addUnit(new Tracker(name, todo), weight)
```

* var subStream = tracker.newStream(**name**, **todo**, **weight**)

上記は次に相当します。

```javascript
  var subStream = tracker.addUnit(new TrackerStream(name, todo), weight)
```

* console.log( tracker.debug() )

すべての子を再帰的に入力するなど、このトラッカー グループとそのすべての子の完了を示すツリーを返します。

<a name="tracker"></a>Tracker
=======

* var tracker = new Tracker(**name**, **todo**)

  * **name** *(省略可能)* 変更イベントで報告するこのカウンターの名前。  既定値は未定義です。
  * **todo** *(省略可能)* 実行する作業の量 (数値)。 既定値は 0 です。

通常、これらはトラッカー グループの一部として構築されます (`newItem` から)。

* var completed = tracker.completed()

完了した作業と実行する作業の比率を返します。 0 から 1 の範囲。 実行する作業の合計が 0 の場合は、0 が返されます。

* tracker.addWork(**todo**)

  * **todo** 実行する作業の量に加算する数値。

実行する作業の量を増やし、完了率が下がります。  `change` イベントをトリガーします。

* tracker.completeWork(**completed**)

  * **completed** 完了した作業に可算する数値

完了した作業の量を増やし、完了率が上がります。
実行する作業量を超えて完了した作業量を増やすことは決してありません。 つまり、100% を超えるパーセンテージは許可されません。 `change` イベントをトリガーします。

* tracker.finish()

このトラッカーを完了としてマークすると、tracker.completed() は 1 になります。 `change` イベントをトリガーします。

<a name="trackerstream"></a>TrackerStream
=============

* var tracker = new TrackerStream(**name**, **size**, **options**)

  * **name** *(省略可能)* 変更イベントで報告するこのカウンターの名前。  既定値は未定義です。
  * **size** *(省略可能)* このストリームを介して送信されるバイト数。
  * **options** *(省略可能)* ストリーム オプションのハッシュ

トラッカー ストリーム オブジェクトは、ブロックが通過するたびに内部トラッカー オブジェクトを更新するパススルー ストリームです。  ダウンロード、ファイルの抽出、その他の関連アクティビティを追跡することを目的としています。 これを使用するには、データ ソースをそれにパイプし、データ ソースとして使用します。

データに長さ属性がある場合、チャンクが渡されるときに完了した作業量として使用されます。  そうでない場合 (オブジェクト ストリームなど)、各チャンクは 1 単位の作業を完了するとカウントされるため、サイズはストリーミングされるオブジェクトの合計数である必要があります。

* tracker.addWork(**todo**)

  * **todo** 予想される全体的なサイズを **todo** バイトずつ増やします。

実行する作業の量を増やし、完了率が下がります。  `change` イベントをトリガーします。
