---
ms.openlocfilehash: aa7ddb2f2ce7709064cf5157f709fc1eff52cff7
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052595"
---
## <a name="follow-redirects"></a>Follow Redirects (リダイレクトのフォロー)

自動的にリダイレクトに従うノードの `http` と `https` モジュールのドロップイン置換。

[![npm のバージョン](https://img.shields.io/npm/v/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![ビルドの状態](https://github.com/follow-redirects/follow-redirects/workflows/CI/badge.svg)](https://github.com/follow-redirects/follow-redirects/actions)
[![カバレッジの状態](https://coveralls.io/repos/follow-redirects/follow-redirects/badge.svg?branch=master)](https://coveralls.io/r/follow-redirects/follow-redirects?branch=master)
[![npm のダウンロード](https://img.shields.io/npm/dm/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![GitHub 上のスポンサー](https://img.shields.io/static/v1?label=Sponsor&message=%F0%9F%92%96&logo=GitHub)](https://github.com/sponsors/RubenVerborgh)

`follow-redirects` は、ネイティブの [http](https://nodejs.org/api/http.html#http_http_request_options_callback) および [https](https://nodejs.org/api/https.html#https_https_request_options_callback) モジュールで見つかったものと同じように動作する [request](https://nodejs.org/api/http.html#http_http_request_options_callback) および [get](https://nodejs.org/api/http.html#http_http_get_options_callback) メソッドを提供します。ただし、リダイレクトにシームレスに従うという例外があります。

```javascript
const { http, https } = require('follow-redirects');

http.get('http://bit.ly/900913', response => {
  response.on('data', chunk => {
    console.log(chunk);
  });
}).on('error', err => {
  console.error(err);
});
```

`response` の `responseUrl` プロパティを使用して、最終的にリダイレクトされた URL を調べることができます。
リダイレクトが行われなかった場合は、`responseUrl` が元の要求 URL です。

```javascript
const request = https.request({
  host: 'bitly.com',
  path: '/UHfDGO',
}, response => {
  console.log(response.responseUrl);
  // 'http://duckduckgo.com/robots.txt'
});
request.end();
```

## <a name="options"></a>オプション
### <a name="global-options"></a>グローバルなオプション
グローバル オプションは、`follow-redirects` モジュールで直接設定されます。

```javascript
const followRedirects = require('follow-redirects');
followRedirects.maxRedirects = 10;
followRedirects.maxBodyLength = 20 * 1024 * 1024; // 20 MB
```

次のグローバル オプションがサポートされています。

- `maxRedirects` (既定値: `21`) – 許可されるリダイレクトの最大数を設定します。これを超えると、エラーが生成されます。

- `maxBodyLength` (既定値:10 MB) – 要求本文の最大サイズを設定します。これを超えるとエラーが生成されます。

### <a name="per-request-options"></a>要求ごとのオプション
要求ごとのオプションは、オブジェクトを `options` 渡すことで設定されます。

```javascript
const url = require('url');
const { http, https } = require('follow-redirects');

const options = url.parse('http://bit.ly/900913');
options.maxRedirects = 10;
options.beforeRedirect = (options, { headers }) => {
  // Use this to adjust the request options upon redirecting,
  // to inspect the latest response headers,
  // or to cancel the request by throwing an error
  if (options.hostname === "example.com") {
    options.auth = "user:password";
  }
};
http.request(options);
```

[標準 HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) および [HTTPS オプション](https://nodejs.org/api/https.html#https_https_request_options_callback)に加えて、次の要求ごとのオプションがサポートされています。
- `followRedirects` (既定値: `true`) – リダイレクトに従う必要があるかどうか。

- `maxRedirects` (既定値: `21`) – 許可されるリダイレクトの最大数を設定します。これを超えると、エラーが生成されます。

- `maxBodyLength` (既定値:10 MB) – 要求本文の最大サイズを設定します。これを超えるとエラーが生成されます。

- `beforeRedirect` (既定値: `undefined`) – 必要に応じてリダイレクト時に要求 `options` を変更するか、エラーをスローして要求を中止します。

- `agents` (既定値: `undefined`) – HTTP と HTTPS は異なるエージェントを使用するため、プロトコルごとに `agent` オプションを設定します。 値の例: `{ http: new http.Agent(), https: new https.Agent() }`

- `trackRedirects` (既定値: `false`) – リダイレクトされた応答の詳細を応答オブジェクトの `redirects` 配列に格納するかどうか。


### <a name="advanced-usage"></a>詳細な使用方法
既定では、`follow-redirects` は、[`http`](https://nodejs.org/api/http.html) と [`https`](https://nodejs.org/api/https.html) の Node.js の既定の実装を使用します。
キャッシュや中間要求の追跡などの機能を有効にするには、代わりに `follow-redirects` をカスタム プロトコル実装でラップできます。

```javascript
const { http, https } = require('follow-redirects').wrap({
  http: require('your-custom-http'),
  https: require('your-custom-https'),
});
```

このようなカスタム プロトコルには、`request` メソッドの実装のみが必要です。

## <a name="browser-usage"></a>ブラウザー使用状況

ブラウザーの動作方法により、`http` と `https` のブラウザーに相当するものは、既定でリダイレクトを実行します。

次の方法で `follow-redirects` を要求します。
```javascript
const http = require('follow-redirects/http');
const https = require('follow-redirects/https');
```
これにより、Webpack や友達に `follow-redirect` を組み込みのバージョンと置き換えるように簡単に指示できるようになります。

```json
{
  "follow-redirects/http"  : "http",
  "follow-redirects/https" : "https"
}
```

## <a name="contributing"></a>共同作成

pull request は常に歓迎されます。 貴重なお時間を投資する前に、提案の詳細を示す [Issue を提出](https://github.com/follow-redirects/follow-redirects/issues)してください。 追加の機能とバグ修正には、テストを伴う必要があります。 簡単な `npm test` コマンドを使用して、テスト スイートをローカルで実行できます。

## <a name="debug-logging"></a>デバッグ ログ

`follow-redirects` は、優れた[デバッグ](https://www.npmjs.com/package/debug) をログに使用します。 ログを有効にするには、このモジュールからのデバッグ出力用の環境変数 `DEBUG=follow-redirects` を設定します。 テスト スイートを実行する場合は、高速サーバーからの出力も表示するように `DEBUG=*` を設定すると便利な場合があります。

## <a name="authors"></a>Authors

- [Ruben Verborgh](https://ruben.verborgh.org/)
- [Olivier Lalonde](mailto:olalonde@gmail.com)
- [James Talmage](mailto:james@talmage.io)

## <a name="license"></a>ライセンス

[MIT ライセンス](https://github.com/follow-redirects/follow-redirects/blob/master/LICENSE)
