---
ms.openlocfilehash: ca1f677bd38876befee833fcedd10388a71aecf4
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053109"
---
<a name="agent-base"></a>agent-base
==========
### <a name="turn-a-function-into-an-httpagenthttpagent-instance"></a>関数を [`http.Agent`][http.Agent] インスタンスに変換する
[![ビルドの状況](https://github.com/TooTallNate/node-agent-base/workflows/Node%20CI/badge.svg)](https://github.com/TooTallNate/node-agent-base/actions?workflow=Node+CI)

このモジュールでは `http.Agent` ジェネレーターを提供します。 つまり、非同期コールバック関数を渡すと、送信 HTTP 要求の送信時に指定されたコールバック関数を呼び出す新しい `http.Agent` インスタンスが返されます。

#### <a name="some-subclasses"></a>いくつかのサブクラス:

ここでは、`agent-base` のより興味深い用法を示します。
pull request を送信して、あなたの分もリストに加えましょう。

 * [`http-proxy-agent`][http-proxy-agent]: HTTP エンドポイント向けの HTTP(s) プロキシ `http.Agent` 実装
 * [`https-proxy-agent`][https-proxy-agent]:HTTPS エンドポイント向けの HTTP(s) プロキシ `http.Agent` 実装
 * [`pac-proxy-agent`][pac-proxy-agent]: HTTP および HTTPS 向けの PAC ファイル プロキシ `http.Agent` 実装
 * [`socks-proxy-agent`][socks-proxy-agent]:HTTP および HTTPS 向けの SOCKS ファイル プロキシ `http.Agent` 実装


<a name="installation"></a>インストール
------------

`npm` を使用したインストール:

``` bash
$ npm install agent-base
```


<a name="example"></a>例
-------

HTTP 要求ごとにサーバーへの新しい `net.Socket` 接続を作成する最小限の例を次に示します (つまり、`agent: false` オプションに相当します)。

```js
var net = require('net');
var tls = require('tls');
var url = require('url');
var http = require('http');
var agent = require('agent-base');

var endpoint = 'http://nodejs.org/api/';
var parsed = url.parse(endpoint);

// This is the important part!
parsed.agent = agent(function (req, opts) {
  var socket;
  // `secureEndpoint` is true when using the https module
  if (opts.secureEndpoint) {
    socket = tls.connect(opts);
  } else {
    socket = net.connect(opts);
  }
  return socket;
});

// Everything else works just like normal...
http.get(parsed, function (res) {
  console.log('"response" event!', res.headers);
  res.pipe(process.stdout);
});
```

Promise を返すことや `async` 関数の使用もサポートされています。

```js
agent(async function (req, opts) {
  await sleep(1000);
  // etc…
});
```

別の `http.Agent` インスタンスを返して、その HTTP 要求の責任をそのエージェントに "パス スルー" します。

```js
agent(function (req, opts) {
  return opts.secureEndpoint ? https.globalAgent : http.globalAgent;
});
```


<a name="api"></a>API
---

## <a name="agentfunction-callback-object-options--httpagent"></a>Agent(Function callback[, Object options]) → [http.Agent][]

`agent` として使用されるすべての HTTP 要求に、コールバック関数 `callback` を実行するベース `http.Agent` を作成します。 コールバック関数は、HTTP 要求の基になるソケットとして使用される何らかの種類の `stream.Duplex` インスタンスを作成する役割を担います。

`options` オブジェクトでは、次のプロパティを受け入れます。

  * `timeout` - 数値 - `callback()` 関数のタイムアウト (ミリ秒単位)。 既定値は Infinity (省略可能) です。

コールバック関数には、次のシグネチャが必要です。

### <a name="callbackhttpclientrequest-req-object-options-function-cb--undefined"></a>callback(http.ClientRequest req, Object options, Function cb) → 未定義

ClientRequest `req` にアクセスして、要求ヘッダー、パスなどを読み取ることができます。`options` オブジェクトには、`http.request()`/`https.request()` 関数呼び出しに渡されるオプションが含まれており、`net.connect()`/`tls.connect()` に直接渡されるようにフォーマットされていますが、それ以外の場合は、ソケットを作成する必要があります。 作成されたソケットを作成したコールバック関数 `cb` に渡すと、HTTP 要求が続行されます。

`https` モジュールを使用して HTTP 要求を呼び出す場合、`options` の `secureEndpoint` プロパティは  _に設定されます`true`_ 。


<a name="license"></a>ライセンス
-------

(MIT ライセンス)

Copyright (c) 2013 Nathan Rajlich &lt;nathan@tootallnate.net&gt;

以下に定める条件に従って、本ソフトウェアおよび関連文書ファイルのコピー (以下、''ソフトウェア'') を取得したすべての人物に対して、ソフトウェアのコピーを使用、コピー、修正、結合、発行、配布、サブライセンス、または販売すること、およびソフトウェアの供給先がこれらを行うことを許可する無制限の権利も含めて、本ソフトウェアを制限なしで扱う許可を無償で与えます。

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

ソフトウェアは ''現状のまま'' で提供され、明示的または暗黙的にかかわらず、市販性、特定用途への適合性、および権利侵害がないことも含めて、何らかの保証が提供されることはありません。
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

[http-proxy-agent]: https://github.com/TooTallNate/node-http-proxy-agent
[https-proxy-agent]: https://github.com/TooTallNate/node-https-proxy-agent
[pac-proxy-agent]: https://github.com/TooTallNate/node-pac-proxy-agent
[socks-proxy-agent]: https://github.com/TooTallNate/node-socks-proxy-agent
[http.Agent]: https://nodejs.org/api/http.html#http_class_http_agent
