---
ms.openlocfilehash: 50690c00791b1f6ca1d585c1fb653f0ec4794578
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052659"
---
# <a name="prebuild-install"></a>prebuild-install

> **特定のプラットフォームに複数のバージョンの Node.js と Electron のプレビルド バイナリを簡単にインストールするためのコマンド ライン ツール。**
> 既定では、GitHub リリースからプレビルド バイナリがダウンロードされます。

[![npm](https://img.shields.io/npm/v/prebuild-install.svg)](https://www.npmjs.com/package/prebuild-install)
![ノード バージョン](https://img.shields.io/node/v/prebuild-install.svg)
[![テスト](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml/badge.svg)](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml)
[![david](https://david-dm.org/prebuild/prebuild-install.svg)](https://david-dm.org/prebuild/prebuild-install)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)

## <a name="note"></a>Note

**[`prebuild-install`](https://github.com/prebuild/prebuild-install) とペアになっている [`prebuild`](https://github.com/prebuild/prebuild) ではなく、[`node-gyp-build`](https://github.com/prebuild/node-gyp-build) とペアになっている [`prebuildify`](https://github.com/prebuild/prebuildify) をお勧めします。**

`prebuildify` では、すべてのブレビルド バイナリが npm に発行されたパッケージに付属しています。これは、`prebuild` のように個別のダウンロード手順を行う必要がないことを意味します。 皮肉なことに、この方法は 1 つのプレビルド バイナリをインストール スクリプトとしてダウンロードするよりも、バンドルされているすべてのプラットフォームのすべてのプレビルド バイナリをダウンロードする方が速くなります。

利点:

1. 追加のダウンロード手順がないため、信頼性がより高くなり、インストールがより速くなります。
2. ローカルでのランタイム バージョンの変更と、Node.js と Electron の間での同じインストールの使用がサポートされます。 すべてのプレビルド バイナリは npm tarball にあり、正しいものが実行時に選択されるだけなので、再インストールやリビルドは必要ありません。
3. `node-gyp-build` ランタイムの依存関係はなく、原則外でもそのままになります。これは、依存関係を導入すると、より短いインストール時間が台無しになるためです。
4. プレビルド バイナリは、npm インストール スクリプトが無効になっている場合でも機能します。
5. npm パッケージのチェックサムでは、プレビルド バイナリも対象となります。

欠点:

1. ディスク上にインストールされている npm パッケージのサイズが大きくなります。 [Node-API](https://nodejs.org/api/n-api.html) を使用すると、これが軽減されます。Node-API バイナリはランタイムに依存せず、上位互換性があるためです。
2. `npm publish` はプレビルド バイナリをコンパイルしてフェッチした後 (通常は CI で) 行う必要があるため、発行はやや複雑になります。

## <a name="usage"></a>使用

[`prebuild`](https://github.com/prebuild/prebuild) を使用して、プレビルド バイナリを作成してアップロードします。 その後、package.json インストール スクリプトを変更します。

```json
{
  "scripts": {
    "install": "prebuild-install || node-gyp rebuild"
  }
}
```

### <a name="help"></a>Help

```
prebuild-install [options]

  --download    -d  [url]       (download prebuilds, no url means github)
  --target      -t  version     (version to install for)
  --runtime     -r  runtime     (Node runtime [node, napi or electron] to build or install for, default is node)
  --path        -p  path        (make a prebuild-install here)
  --token       -T  gh-token    (github token for private repos)
  --arch            arch        (target CPU architecture, see Node OS module docs, default is current arch)
  --platform        platform    (target platform, see Node OS module docs, default is current platform)
  --tag-prefix <prefix>         (github tag prefix, default is "v")
  --build-from-source           (skip prebuild download)
  --verbose                     (log verbosely)
  --libc                        (use provided libc rather than system default)
  --debug                       (set Debug or Release configuration)
  --version                     (print prebuild-install version and exit)
```

`prebuild-install` が `npm` スクリプトを使用して実行される場合、オプション `--build-from-source`、`--debug`、`--download`、`--target`、`--runtime`、`--arch` および `--platform` は、`npm` コマンドに指定された引数を介して渡すことができます。

環境変数 `npm_config_build_from_source=true`、`npm_config_platform`、`npm_config_arch`、`npm_config_target` および `npm_config_runtime` を設定することもできます。

### <a name="private-repositories"></a>プライベート リポジトリ

`prebuild-install` では、`-T <github-token>` を使用してプライベート GitHub リポジトリからプレビルドをダウンロードできます。

```
$ prebuild-install -T <github-token>
```

CLI でトークンを使用しない場合は、`~/.prebuild-installrc` に配置することができます。

```
token=<github-token>
```

環境変数 `prebuild-install_token` で指定することもできます。

GitHub トークンを使用すると、API を使って適切なリリースが解決されることに注意してください。つまり、[GitHub レート制限](https://developer.github.com/v3/rate_limit/)の対象になります。

### <a name="create-github-token"></a>GitHub トークンを作成する

トークンを作成するには:

- [このページ](https://github.com/settings/tokens)に移動します
- `Generate new token` ボタンをクリックします。
- トークンに名前を付けて `Generate token` ボタンをクリックします。以下を参照してください

![prebuild-token](https://cloud.githubusercontent.com/assets/13285808/20844584/d0b85268-b8c0-11e6-8b08-2b19522165a9.png)

既定のスコープで問題ありません。

### <a name="custom-binaries"></a>カスタム バイナリ

エンド ユーザーは、.npmrc ファイル内の環境変数を使用してバイナリのダウンロード場所をオーバーライドできます。
変数はマスク `% your package name %_binary_host` または `% your package name %_binary_host_mirror` を満たす必要があります。 次に例を示します。

```
leveldown_binary_host=http://overriden-host.com/overriden-path
```

パッケージ バージョンのサブパスとファイル名は引き続き追加されることに注意してください。
したがって、`leveldown@1.2.3` をインストールする場合、結果の URL は次のようになります。

```
http://overriden-host.com/overriden-path/v1.2.3/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

#### <a name="local-prebuilds"></a>ローカルのプレビルド

ローカル ファイルシステムからプレビルドを使用する場合は、`% your package name %_local_prebuilds` .npmrc 変数を使用して、プレビルドを含むフォルダーへのパスを設定できます。 次に例を示します。

```
leveldown_local_prebuilds=/path/to/prebuilds
```

このオプションでは、`prebuild` で作成されたバンドルをそのフォルダーで直接探します。例を以下に示します。

```
/path/to/prebuilds/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

非絶対パスは、prebuild-install を呼び出すパッケージのディレクトリを基準にして解決されます (例: 入れ子になった依存関係の場合)。

### <a name="cache"></a>キャッシュ

トラフィックを最小限に抑えるために、すべてのプレビルド バイナリがキャッシュされます。 そのため、最初に `prebuild-install` ではキャッシュからバイナリを選択し、バイナリが見つからなかった場合はダウンロードされます。 環境に応じて、キャッシュ フォルダーは次の順序で決定されます。

- `${npm_config_cache}/_prebuilds`
- `${APP_DATA}/npm-cache/_prebuilds`
- `${HOME}/.npm/_prebuilds`

## <a name="license"></a>ライセンス

MIT
