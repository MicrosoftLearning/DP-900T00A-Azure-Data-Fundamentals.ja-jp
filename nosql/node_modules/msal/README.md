---
ms.openlocfilehash: 4f36d4681facd228c63b48050973040e9785d30f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052179"
---

<a name="microsoft-authentication-library-for-javascript-msaljs"></a>JavaScript 用の Microsoft Authentication Library (MSAL.js)
=========================================================

| [はじめに](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)| [AAD ドキュメント](https://aka.ms/aaddevv2) | [ライブラリ リファレンス](https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal.html) | [サポート](README.md#community-help-and-support) | [サンプル](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)
| --- | --- | --- | --- | --- |

⚠️⚠️⚠️ このライブラリは新機能を受信しなくなり、重要なバグとセキュリティ修正プログラムのみを受け取ります。 新しいアプリケーションでは、代わりに [@azure/msal-browser](https://www.npmjs.com/package/@azure/msal-browser) を使用してください。 ⚠️⚠️⚠️

JavaScript 用の MSAL を使用すると、Web ブラウザーで実行されているクライアント側の JavaScript Web アプリケーションは [Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-overview) の職場および学校アカウント (AAD)、Microsoft 個人アカウント (MSA)、Facebook、Google、LinkedIn、Microsoft アカウントなどのソーシャル ID プロバイダーを使用して、[Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers) サービス経由でユーザーを認証できます。 また、アプリは、[Microsoft Graph](https://graph.microsoft.io) などの [Microsoft Cloud](https://www.microsoft.com/enterprise) サービスにアクセスするためのトークンを取得することもできます。

[![npm バージョン](https://img.shields.io/npm/v/msal.svg?style=flat)](https://www.npmjs.com/package/msal)
[![npm バージョン](https://img.shields.io/npm/dm/msal.svg)](https://nodei.co/npm/msal/)
[![codecov](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js/branch/dev/graph/badge.svg?flag=msal-core)](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js)

## <a name="installation"></a>インストール

### <a name="via-npm"></a>NPM 経由:

    npm install msal

## <a name="via-cdn"></a>CDN 経由:

<!-- CDN_LATEST -->
```html
<script type="text/javascript" src="https://alcdn.msauth.net/lib/1.4.11/js/msal.min.js"></script>
```

CDN の使用に関する[完全な詳細とベスト プラクティス](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/docs/cdn.md)については、Microsoft のドキュメントを参照してください。

## <a name="what-to-expect-from-this-library"></a>このライブラリに期待できる内容
Javascript での MSAL のサポートは、ライブラリのコレクションです。 `msal-core` (または単純に `msal`) は、フレームワークに依存しないコア ライブラリです。 core 1.x+ が安定したら、最新の 1.x の機能強化を含む `msal-angular` ライブラリを導入します。  フレームワークとライブラリの使用傾向で、Angular 1x ではなく、Angular 2+ の導入が増えていることが示されているため、`msal-angularjs` のサポートは廃止する予定です。 現在のライブラリが標準に準拠したら、新しい機能の要求と、`react` や `node.js` のような新しいプラットフォームの間で調整を始めます。

私たちの目標は、コミュニティとできるだけ円滑にコミュニケーションし、彼らの意見を考慮することです。 毎月のマイナー リリース スケジュールに従い、必要に応じてパッチを提供したいと考えています。  私たちが従うコミュニケーション、計画、細分性のレベルは、進行中の作業になります。

[ロードマップ](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki#roadmap)を確認して、取り組んでいる内容と次に行おうとしている内容を確認してください。

## <a name="oauth-20-and-the-implicit-flow"></a>OAuth 2.0 と暗黙的なフロー

MSAL は、OAuth 2.0 プロトコルで定義されているように[暗黙的な許可のフロー](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow)を実装し、[OpenID](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc) に準拠しています。

私たちの目標は、プラグ アンド プレイ認証を取得できるようにライブラリがプロトコルを十分に抽象化することですが、セキュリティの観点から暗黙的なフローを知って理解することが重要です。
暗黙的なフローは、クライアント シークレットを安全に管理できない Web ブラウザーのコンテキストで実行されます。 これは単一ページ アプリ用に最適化されており、クライアントとサーバーの間のホップが 1 つ少ないため、トークンがブラウザーに直接返されます。 このような側面により、自ずと安全性が低下します。
このようなセキュリティ上の懸念は、有効期間が短いトークンの使用 (更新トークンが返されない)、アプリに登録されたリダイレクト URI を必要とするライブラリ、要求と応答を一意の nonce および状態パラメーターと一致させるライブラリなど、標準的なプラクティスに従って軽減されます。

## <a name="cache-storage"></a>キャッシュ ストレージ

Microsoft は、MSAL 用の 2 つの保存法である `localStorage` と `sessionStorage` を提供しています。  ユーザーが取得したトークンをより安全に格納できるため、`sessionStorage` を使用することが推奨されます。ただし、`localStorage` を使用すると、タブとユーザー セッションをまたいだシングル サイン オンを実行できるようになります。  オプションを検討し、アプリケーションに最適な決定を行うことをお勧めします。

### <a name="forcerefresh-to-skip-cache"></a>キャッシュをスキップする forceRefresh
キャッシュされたトークンをスキップしてサーバーに移動する場合は、ブール型の `forceRefresh` を、ログインまたはトークンの要求を行うために使用する `AuthenticationParameters` オブジェクトに渡してください。 **警告:** これは、アプリケーションのパフォーマンスに影響するため、既定では使用しないでください。  キャッシュに依存すると、ユーザーのエクスペリエンスが向上するため、スキップは、現在キャッシュされているデータに最新の情報がないことがわかっているシナリオでのみ使用する必要があります。  例: 更新ロールで新しいトークンを取得する必要があるユーザーに対してロールを追加する管理ツール。

## <a name="usage"></a>使用
次の例は、ユーザーがログインし、Microsoft の Graph API に使用するトークンを取得する方法について説明しています。

#### <a name="prerequisites"></a>前提条件

MSAL.js を使用する前に、[Azure AD にアプリケーションを登録](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)して構成に有効な `clientId` を取得し、アプリがリダイレクト トラフィックを受け入れるルートを登録する必要があります。

#### <a name="1-instantiate-the-useragentapplication"></a>1.UserAgentApplication をインスタンス化する

`UserAgentApplication` は [Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#configuration-options) で詳しく説明されているさまざまなオプションを使用して構成できますが、必要なパラメーターは `auth.clientId` のみです。

インスタンスをインスタンス化した後、MSAL 1.2.x 以前 (`loginRedirect` および `acquireTokenRedirect`) でリダイレクト フローを使用する予定がある場合は、`authCallback = function(AuthError, AuthResponse)` である `handleRedirectCallback(authCallback)` を使用してコールバック ハンドラーを登録する必要があります。 MSAL 1.3.0 以降、これは省略可能です。 コールバック関数は、認証要求が正常に完了した後、または失敗した後に呼び出されます。 ポップアップ フローでは Promise が返されるので、これは必須ではありません。

```JavaScript
    import * as Msal from "msal";
    // if using cdn version, 'Msal' will be available in the global scope

    const msalConfig = {
        auth: {
            clientId: 'your_client_id'
        }
    };

    const msalInstance = new Msal.UserAgentApplication(msalConfig);

    msalInstance.handleRedirectCallback((error, response) => {
        // handle redirect response or error
    });

```

構成オプションの詳細については、「[MSAL.js を使用してクライアント アプリケーションを初期化する](https://docs.microsoft.com/azure/active-directory/develop/msal-js-initializing-client-applications)」を参照してください。

#### <a name="2-login-the-user"></a>2. ユーザーがログインする

アプリでは、ユーザー コンテキストを確立するために、`loginPopup` または `loginRedirect` のメソッドを使用してユーザーがログインする必要があります。

ログイン メソッドが呼び出され、Azure AD サービスによってユーザーの認証が完了すると、[ID トークン](https://docs.microsoft.com/azure/active-directory/develop/id-tokens)が返されます。これは、ユーザーを基本情報で識別するために使用されます。

ユーザーがログインするときに、ログイン時に事前に同意できるスコープを渡すことができますが、これは必須ではありません。 ログイン時にスコープに同意しても、そのスコープの access_token は返されませんが、そのスコープが渡された状態でトークンをサイレントに取得する機会が与えられます。ユーザーからのそれ以上の対話式操作はありません。

必要なスコープを必要なときにのみ要求する (動的同意と呼ばれる概念です) ことをお勧めします。 これにより、アプリケーション内でユーザーからの同意をより対話的に得ることができますが、まだ使用していない機能に対して広範囲のアクセス許可を与えるのが不安なユーザーのドロップオフも少なくなります。

AAD では、一度に 3 つのリソースに対してのみ同意を得ることができますが、リソース内の多くのスコープを要求できます。
ユーザーがログイン要求を行うと、複数のリソースとそれに対応するスコープを渡すことができます。AAD が、それらのスコープに事前に同意する idToken を発行するためです。 ただし、acquireToken の呼び出しは、1 つのリソースまたは複数のスコープに対してのみ有効です。 複数のリソースにアクセスする必要がある場合は、リソースごとに個別の acquireToken の呼び出しを行ってください。

```JavaScript
   var loginRequest = {
       scopes: ["user.read", "mail.send"] // optional Array<string>
   };

    msalInstance.loginPopup(loginRequest)
        .then(response => {
            // handle response
        })
        .catch(err => {
            // handle error
        });

```

##### <a name="ssosilent"></a>ssoSilent

ユーザーが既存のセッションを持っていることがわかっており、対話式操作を求めずにユーザー コンテキストを確立したい場合は、`loginHint` または `sid` ([省略可能な要求](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)として使用可能) で `ssoSilent` を呼び出すことができ、MSAL は、既存のセッションに対してサイレントに SSO を試み、ユーザー コンテキストを確立します。

指定された `loginHint` または `sid` にアクティブなセッションがない場合は、エラーがスローされます。これは、対話型ログイン メソッド (`loginPopup` または `loginRedirect`) を呼び出すことによって処理する必要があります。

例:

```js
const ssoRequest = {
    loginHint: "user@example.com"
};

msalInstance.ssoSilent(ssoRequest)
    .then(response => {
        // session silently established
    })
    .catch(error => {
        // handle error by invoking an interactive login method
        msalInstance.loginPopup(ssoRequest);
    });
```

#### <a name="3-get-an-access-token-to-call-an-api"></a>3. API を呼び出すアクセス トークンを取得する

MSAL では、アクセス トークンを取得するために Azure AD に (UI でユーザーにダイアログを表示することなく) サイレントな要求を行う `acquireTokenSilent` メソッドを使用して、アプリが呼び出す必要がある API のアクセス トークンを取得できます。 その後、Azure AD サービスは、アプリが API を安全に呼び出せるように、ユーザーが同意したスコープを含む[アクセス トークン](https://docs.microsoft.com/azure/active-directory/develop/access-tokens)を返します。

`acquireTokenRedirect` または `acquireTokenPopup` を使用して対話型の要求を開始することもできますが、対話が必要なエラーが原因でトークンをサイレントに取得できない場合にのみ対話型エクスペリエンスを表示することをお勧めします。 対話型のトークン呼び出しを使用している場合は、アプリケーションで使用されるログイン メソッドと一致する必要があります。 (`loginPopup`=> `acquireTokenPopup`, `loginRedirect` => `acquireTokenRedirect`).

`acquireTokenSilent` の呼び出しが、種類 `InteractionRequiredAuthError` のエラーで失敗した場合は、対話型の要求を開始する必要があります。  これは、スコープの失効、期限切れのトークン、パスワードの変更など、さまざまな理由で発生する可能性があります。

`acquireTokenSilent` はキャッシュ内で有効なトークンを探し、有効期限が近いか存在しない場合は、自動的に更新を試みます。

詳細については、[要求と応答のデータ型](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#signing-in-and-getting-tokens-with-msaljs)に関する記事を参照してください。

```JavaScript
    // if the user is already logged in you can acquire a token
    if (msalInstance.getAccount()) {
        var tokenRequest = {
            scopes: ["user.read", "mail.send"]
        };
        msalInstance.acquireTokenSilent(tokenRequest)
            .then(response => {
                // get access token from response
                // response.accessToken
            })
            .catch(err => {
                // could also check if err instance of InteractionRequiredAuthError if you can import the class.
                if (err.name === "InteractionRequiredAuthError") {
                    return msalInstance.acquireTokenPopup(tokenRequest)
                        .then(response => {
                            // get access token from response
                            // response.accessToken
                        })
                        .catch(err => {
                            // handle error
                        });
                }
            });
    } else {
        // user is not logged in, you will need to log them in to acquire a token
    }
```

#### <a name="4-use-the-token-as-a-bearer-in-an-http-request-to-call-the-microsoft-graph-or-a-web-api"></a>4. トークンを HTTP 要求でベアラーとして使用して、Microsoft Graph または Web API を呼び出す

```JavaScript
    var headers = new Headers();
    var bearer = "Bearer " + token;
    headers.append("Authorization", bearer);
    var options = {
         method: "GET",
         headers: headers
    };
    var graphEndpoint = "https://graph.microsoft.com/v1.0/me";

    fetch(graphEndpoint, options)
        .then(resp => {
             //do something with response
        });
```

[MSAL の Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) に記載されている MSAL.js 機能の詳細を確認し、完全な[コード サンプル](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)を見つけることができます。

## <a name="security-reporting"></a>セキュリティ レポート

ライブラリまたはサービスでセキュリティに関する問題が見つかった場合は、それを、できるだけ詳細に [secure@microsoft.com](mailto:secure@microsoft.com) に報告してください。 お客様の提出物は、[Microsoft Bounty](http://aka.ms/bugbounty) プログラムを通じて報奨金の対象となる場合があります。 GitHub の Issue またはその他のいずれのパブリック サイトにも、セキュリティの問題を投稿しないでください。 情報が届きましたら、すぐにこちらからお客様に連絡します。 セキュリティの問題が発生したときに通知を受け取ることをお勧めします。そのためには、[このページ](https://technet.microsoft.com/security/dd252948)にアクセスし、セキュリティ アドバイザリ通知を受信登録してください。

## <a name="license"></a>ライセンス

Copyright (c) Microsoft Corporation.  All rights reserved. MIT ライセンス ("ライセンス") に基づき使用が許諾されています。

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>Microsoft は、Microsoft オープン ソースの倫理規定を尊重し、遵守します

このプロジェクトは、「[Microsoft のオープン ソースの倫理規定](https://opensource.microsoft.com/codeofconduct/)」を採用しています。 詳細については[論理規定についてのよくある質問](https://opensource.microsoft.com/codeofconduct/faq/)をご覧ください。また、追加の質問やコメントがある場合は[opencode@microsoft.com](mailto:opencode@microsoft.com)にお問い合わせください。
