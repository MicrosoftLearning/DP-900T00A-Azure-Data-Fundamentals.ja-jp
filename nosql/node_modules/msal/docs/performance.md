---
ms.openlocfilehash: f47c4027d8f89b4c990bdc7ee5ed502e74ff0294
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "145884566"
---
# <a name="performance"></a>パフォーマンス

このドキュメントでは、MSAL.js を使用してトークンを取得するパフォーマンスを向上させるためにアプリケーションで使用できる手法について概説します。

## <a name="bypass-authority-metadata-resolution"></a>機関メタデータの解決をバイパスする

既定では、トークン MSAL.js を取得するプロセス中に、要求用に構成されたメタデータを機関から取得するための 2 つのネットワーク要求が行われます。 これらのネットワーク要求をスキップする場合は、`UserAgentApplication` の構成で必要なメタデータを指定できます。

**重要:** 正しい最新の機関メタデータを使用していることを確認するのは、アプリケーションの責任です。 失敗すると、アプリケーションが正しく動作しなくなる可能性があります。

手順: 

1. 機関の承認エンドポイントを決定します。 たとえば、`https://login.microsoftonline.com/common/` を使用している場合、承認エンドポイントは `https://login.microsoftonline.com/common/oauth2/v2.0/authorize` です。
2. 機関のインスタンス検出エンドポイントを決定します。 インスタンス検出 API は `https://login.microsoftonline.com/common/discovery/instance?api-version=1.0&authorization_endpoint={authorizeEndpoint}` にあります。 `common` エンドポイントを使用している場合、この URL は `https://login.microsoftonline.com/common/discovery/instance?api-version=1.0&authorization_endpoint=https://login.microsoftonline.com/common/oauth2/v2.0/authorize` です。
3. インスタンス検出エンドポイントに対して要求を行います。
4. 応答から `tenant_discovery_endpoint` プロパティを解析します。
5. `tenant_discovery_endpoint` プロパティの URL に対して要求を行います。
6. 応答 **全体** を受け取り、生の JSON 文字列を `UserAgentApplication` の `auth.authorityMetadata` プロパティとして指定します。 要求ごとに `AuthenticationParameters` の一部として渡すこともできます。

例:

```js
const msalInstance = new msal.UserAgentApplication({
    auth: {
        authorityMetadata: '{"token_endpoint":"https://login.microsoftonline.com/common/oauth2/v2.0/token","token_endpoint_auth_methods_supported":["client_secret_post","private_key_jwt","client_secret_basic"],"jwks_uri":"https://login.microsoftonline.com/common/discovery/v2.0/keys","response_modes_supported":["query","fragment","form_post"],"subject_types_supported":["pairwise"],"id_token_signing_alg_values_supported":["RS256"],"response_types_supported":["code","id_token","code id_token","id_token token"],"scopes_supported":["openid","profile","email","offline_access"],"issuer":"https://login.microsoftonline.com/{tenantid}/v2.0","request_uri_parameter_supported":false,"userinfo_endpoint":"https://graph.microsoft.com/oidc/userinfo","authorization_endpoint":"https://login.microsoftonline.com/common/oauth2/v2.0/authorize","http_logout_supported":true,"frontchannel_logout_supported":true,"end_session_endpoint":"https://login.microsoftonline.com/common/oauth2/v2.0/logout","claims_supported":["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],"tenant_region_scope":null,"cloud_instance_name":"microsoftonline.com","cloud_graph_host_name":"graph.windows.net","msgraph_host":"graph.microsoft.com","rbac_url":"https://pas.windows.net"}'
    }
});
```
