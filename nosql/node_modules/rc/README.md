---
ms.openlocfilehash: 4f70d9e1d8895757244ec8464f178ff3068a36bd
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051086"
---
# <a name="rc"></a>rc

不精なユーザーのための構成不可能な構成ローダー。

## <a name="usage"></a>使用

唯一のオプションは、rc にアプリの名前と既定の構成を渡すことです。

```javascript
var conf = require('rc')(appname, {
  //defaults go here.
  port: 2468,

  //defaults which are objects will be merged, not replaced
  views: {
    engine: 'jade'
  }
});
```

`rc` からは、指定した既定値とマージされた構成オプションが返されます。
定義済みの既定のオブジェクトを渡すと、次のように変更されます。

```javascript
var conf = {};
require('rc')(appname, conf);
```

`rc` がアプリの構成ファイルを検出すると、返される構成オブジェクトには、そのパスを含む `configs` 配列が含まれます。

```javascript
var appCfg = require('rc')(appname, conf);
appCfg.configs[0] // /etc/appnamerc
appCfg.configs[1] // /home/dominictarr/.config/appname
appCfg.config // same as appCfg.configs[appCfg.configs.length - 1]
```

## <a name="standards"></a>標準

アプリケーション名 (`appname`) を指定すると、rc によってすべての明らかな場所で構成が調べられます。

  * minimist によって解析されたコマンド ライン引数 _(例: `--foo baz`、入れ子にされた `--foo.bar=baz` も)_
  * プレフィックス `${appname}_` が付いた環境変数
    * または、"\_\_" を使用して入れ子になったプロパティを示します <br/> _(例: `appname_foo__bar__baz` => `foo.bar.baz`)_
  * オプション `--config file` を渡した場合は、そのファイルから
  * ローカル `.${appname}rc` または `./ ../ ../../ ../../../` などで最初に見つかったもの。
  * `$HOME/.${appname}rc`
  * `$HOME/.${appname}/config`
  * `$HOME/.config/${appname}`
  * `$HOME/.config/${appname}/config`
  * `/etc/${appname}rc`
  * `/etc/${appname}/config`
  * 渡した既定のオブジェクト。

見つかったすべての構成ソースは 1 つのオブジェクトにフラット化されるため、このリストの **前** にあるソースは後のソースをオーバーライドします。


## <a name="configuration-file-formats"></a>構成ファイルの形式

構成ファイル (`.appnamerc` など) は、[json](http://json.org/example) または [ini](http://en.wikipedia.org/wiki/INI_file) 形式にすることができます。 ファイル拡張子 (`.json` または `.ini`) は使用 **しないでください**。 以下の構成例は同じものです。


#### <a name="formatted-as-ini"></a>`ini` 形式

```
; You can include comments in `ini` format if you want.

dependsOn=0.10.0


; `rc` has built-in support for ini sections, see?

[commands]
  www     = ./commands/www
  console = ./commands/repl


; You can even do nested sections

[generators.options]
  engine  = ejs

[generators.modules]
  new     = generate-new
  engine  = generate-backend

```

#### <a name="formatted-as-json"></a>`json` 形式

```javascript
{
  // You can even comment your JSON, if you want
  "dependsOn": "0.10.0",
  "commands": {
    "www": "./commands/www",
    "console": "./commands/repl"
  },
  "generators": {
    "options": {
      "engine": "ejs"
    },
    "modules": {
      "new": "generate-new",
      "backend": "generate-backend"
    }
  }
}
```

コメントは、[strip-json-comments](https://github.com/sindresorhus/strip-json-comments) を使用して JSON 構成から削除されます。

> ini 変数と env 変数には型の標準がないため、アプリケーションは文字列に対応する必要があります。

ブール値と数値の文字列表現が常に適切な型に変換されるようにするには (厳密な `===` 比較を行う場合は特に便利です)、[parse-strings-in-object](https://github.com/anselanza/parse-strings-in-object) などのモジュールを使用して、rc から返される構成オブジェクトをラップすることを検討してください。


## <a name="simple-example-demonstrating-precedence"></a>優先順位を示す簡単な例
次のようなアプリケーションがあるとします (ハードコーディングされた既定値が rc に渡されていることに注意してください)。
```
const conf = require('rc')('myapp', {
    port: 12345,
    mode: 'test'
});

console.log(JSON.stringify(conf, null, 2));
```
また、次のような内容のファイル `config.json` もあります。
```
{
  "port": 9000,
  "foo": "from config json",
  "something": "else"
}
```
そして、同じフォルダー内のファイル `.myapprc` は次のような内容です。
```
{
  "port": "3001",
  "foo": "bar"
}
```
さまざまなコマンドからの予想される出力を次に示します。

`node .`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "bar",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*ハードコーディングされたオブジェクトからの既定値 `mode` は保持されますが、ポートは `.myapprc` ファイルによってオーバーライドされ (appname の一致に基づいて自動的に検出されます)、`foo` が追加されます。*


`node . --foo baz`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "baz",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*上と同じ結果ですが、コマンド ライン引数が `.myapprc` ファイルより優先されるため、`foo` はオーバーライドされます。*

`node . --foo barbar --config config.json`
```
{
  "port": 9000,
  "mode": "test",
  "foo": "barbar",
  "something": "else",
  "_": [],
  "config": "config.json",
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc",
    "config.json"
  ]
}
```
*これで、`port` は指定した `config.json` ファイルから取得され (`.myapprc` の値をオーバーライド)、`foo` の値はやはり `config.json` ファイルで指定されていても、コマンド ラインによってオーバーライドされます。*
 


## <a name="advanced-usage"></a>高度な使用方法

#### <a name="pass-in-your-own-argv"></a>独自の `argv` を渡す

3 番目の引数として独自の `argv` を `rc` に渡すことができます。  これは、[独自のコマンド ライン オプション パーサーを使用する](https://github.com/dominictarr/rc/pull/12)場合です。

```javascript
require('rc')(appname, defaults, customArgvParser);
```

## <a name="pass-in-your-own-parser"></a>独自のパーサーを渡す

非標準パーサーを使用する特別な必要がある場合は、4 番目の引数としてパーサーを渡すことによって行うことができます。
(既定の args パーサーを取得するには、3 番目を null のままにします)

```javascript
require('rc')(appname, defaults, null, parser);
```

これは、厳密で有効な JSON のみなど、より厳密な形式を強制するためにも使用できます。

## <a name="note-on-performance"></a>パフォーマンスに関する注意

`rc` では `fs.statSync` が実行されているため、ホット コード パス (要求ハンドラーなど) ではそれを使わないようにしてください 


## <a name="license"></a>ライセンス

2 つの句の BSD ライセンス、MIT ライセンス、または Apache ライセンスのバージョン 2.0 に基づくマルチライセンス
