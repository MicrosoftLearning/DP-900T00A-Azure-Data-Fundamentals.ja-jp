
---
<p align="center">
  <strong>
    <a href="https://open-telemetry.github.io/opentelemetry-js-api">API ドキュメント<a/> &nbsp;&nbsp;&bull;&nbsp;&nbsp; <a href="https://github.com/open-telemetry/opentelemetry-js/discussions">お問い合わせ (GitHub ディスカッション)<a/>
  </strong>
</p>

<p align="center">
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/releases">
    <img alt="GitHub release (latest by date including pre-releases)" src="https://img.shields.io/github/v/release/open-telemetry/opentelemetry-js-api?include_prereleases&style=for-the-badge">
  </a>
  <a href="https://codecov.io/gh/open-telemetry/opentelemetry-js-api/branch/main/">
    <img alt="Codecov Status" src="https://img.shields.io/codecov/c/github/open-telemetry/opentelemetry-js-api?style=for-the-badge">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE">
    <img alt="license" src="https://img.shields.io/badge/license-Apache_2.0-green.svg?style=for-the-badge">
  </a>
  <br/>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml/badge.svg?branch=main">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml?query=branch%3Amain">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml/badge.svg">
  </a>
</p>

---

# <a name="opentelemetry-api-for-javascript"></a>JavaScript 用 OpenTelemetry API

[![NPM 公開バージョン][npm-img]][npm-url]
[![dependencies][dependencies-image]][dependencies-url]
[![devDependencies][devDependencies-image]][devDependencies-url]

このパッケージは、すべての TypeScript インターフェイス、列挙型、no-op 実装など、OpenTelemetry API とのやりとりに必要なすべてのものを提供します。 これは、サーバーとブラウザーの両方で使用することを目的としています。

このパッケージのメソッドは、既定では操作を実行しません。 つまり、SDK が登録されているかどうかに関係なく、ライブラリまたはエンドユーザー アプリケーションから安全に呼び出すことができます。 テレメトリ データを生成してエクスポートするには、[OpenTelemetry JS SDK][opentelemetry-js] などの SDK も必要です。

## <a name="tracing-quick-start"></a>クイック スタートのトレース

### <a name="you-will-need"></a>以下のものが必要になります

- インストルメント化するアプリケーション
- [OpenTelemetry JS SDK][opentelemetry-js]
- Node.js 8.5.0 以降 (14 以降を推奨) または ECMAScript 5 以降互換ブラウザー

**注:**  ECMAScript 5 以降との互換性はこのパッケージのみで必要です。 ECMAScript の最小バージョンを確認するには、ご利用の SDK のドキュメントを参照してください。

**ライブラリの作成者向けの注意:** OpenTelemetry SDK を必要とするのは、ご自分のエンドユーザーのみです。 ライブラリで OpenTelemetry をサポートする場合は、OpenTelemetry API を使用するだけで済みます。 詳細については、[トレースについてのドキュメント][docs-tracing]を参照してください。

### <a name="install-dependencies"></a>依存関係のインストール

```sh
npm install @opentelemetry/api @opentelemetry/tracing
```

### <a name="trace-your-application"></a>アプリケーションのトレース

トレースを開始するには、まず SDK を登録する必要があります。 ご利用の SDK には、登録メソッドを呼び出す便利なメソッドが用意されている場合がありますが、直接呼び出す場合は、「[SDK 登録メソッド][docs-sdk-registration]」のドキュメントを参照してください。

SDK を登録したら、スパンを開始および終了することができます。 基本的な SDK 登録とシンプルな操作のトレースの簡単な例を次に示します。 この例では、1 秒に 1 回、スパンをコンソールにエクスポートする必要があります。 詳細については、「[トレース][docs-tracing]」のドキュメントを参照してください。

```javascript
const { trace }  = require("@opentelemetry/api");
const { BasicTracerProvider, ConsoleSpanExporter, SimpleSpanProcessor }  = require("@opentelemetry/tracing");

// Create and register an SDK
const provider = new BasicTracerProvider();
provider.addSpanProcessor(new SimpleSpanProcessor(new ConsoleSpanExporter()));
trace.setGlobalTracerProvider(provider);

// Acquire a tracer from the global tracer provider which will be used to trace the application
const name = 'my-application-name';
const version = '0.1.0';
const tracer = trace.getTracer(name, version);

// Trace your application by creating spans
async function operation() {
  const span = tracer.startSpan("do operation");

  // mock some work by sleeping 1 second
  await new Promise((resolve, reject) => {
    setTimeout(resolve, 1000);
  })

  span.end();
}

async function main() {
  while (true) {
    await operation();
  }
}

main();
```

## <a name="version-compatibility"></a>バージョンの互換性

npm インストーラーとノード モジュール解決アルゴリズムでは、特定のパッケージの 2 つ以上のコピーが同じ `node_modules` 構造内に存在する可能性があるため、OpenTelemetry API は `global` オブジェクトの変数を利用してグローバル API を格納します。 API パッケージ内の API メソッドが呼び出されると、この `global` API が存在するかどうかがチェックされ、互換性のある API バージョンの場合にのみ呼び出しがプロキシ経由にされます。 つまり、エンド ユーザーが使用する API と互換性のない OpenTelemetry API バージョンに、パッケージが依存している場合、パッケージは API の no-op 実装を受け取ります。

## <a name="upgrade-guidelines"></a>アップグレードのガイドライン

### <a name="0210-to-100"></a>0.21.0 から 1.0.0

破壊的変更はありません

### <a name="0200-to-0210"></a>0.20.0 から 0.21.0

- [#78](https://github.com/open-telemetry/opentelemetry-js-api/issues/78) `api.context.bind` 引数が反転され、`context` が必須の引数になりました。
- [#46](https://github.com/open-telemetry/opentelemetry-js-api/issues/46) Noop クラスとシングルトンはエクスポートされなくなりました。 noop スパンを作成するには、`NOOP_TRACER` を使用する代わりに `api.trace.wrapSpanContext` を `INVALID_SPAN_CONTEXT` で使用することをお勧めします。

### <a name="100-rc3-to-0200"></a>1.0.0-rc.3 から 0.20.0

- 仕様の一部ではない `TimedEvent` を削除しました
- `HttpBaggage` の名前が `HttpBaggagePropagator` に変更されました
- [#45](https://github.com/open-telemetry/opentelemetry-js-api/pull/45) `Span#context` の名前が `Span#spanContext` に変更されました
- [#47](https://github.com/open-telemetry/opentelemetry-js-api/pull/47) `getSpan`/`setSpan`/`getSpanContext`/`setSpanContext` が `trace` 名前空間に移動しました
- [#55](https://github.com/open-telemetry/opentelemetry-js-api/pull/55) `getBaggage`/`setBaggage`/`createBaggage` が `propagation` 名前空間に移動しました

## <a name="useful-links"></a>便利なリンク

- OpenTelemetry の詳細については、以下を参照してください。<https://opentelemetry.io/>
- OpenTelemetry JavaScript の詳細については、以下を参照してください。<https://github.com/open-telemetry/opentelemetry-js>
- このプロジェクトに関するヘルプやフィードバックについては、[GitHub ディスカッション][discussions-url]にご参加ください

## <a name="license"></a>ライセンス

Apache 2.0 - 詳細については、「[ライセンス][license-url]」を参照してください。

[opentelemetry-js]: https://github.com/open-telemetry/opentelemetry-js

[discussions-url]: https://github.com/open-telemetry/opentelemetry-js/discussions
[license-url]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE
[license-image]: https://img.shields.io/badge/license-Apache_2.0-green.svg?style=flat
[dependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg
[dependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api
[devDependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg?type=dev
[devDependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api?type=dev
[npm-url]: https://www.npmjs.com/package/@opentelemetry/api
[npm-img]: https://badge.fury.io/js/%40opentelemetry%2Fapi.svg
[docs-tracing]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/tracing.md
[docs-sdk-registration]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/sdk-registration.md
