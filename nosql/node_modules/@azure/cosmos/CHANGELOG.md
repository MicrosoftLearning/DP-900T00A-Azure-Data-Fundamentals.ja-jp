---
ms.openlocfilehash: 8d098ac80ecb57d252ad07011486533cd54fe291
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "145884612"
---
# <a name="release-history"></a>リリース履歴

## <a name="3123-2021-07-23"></a>3.12.3 (2021-07-23)

### <a name="bugs-fixed"></a>修正されたバグ

- それぞれ入れ子になったパーティション キーを持つ複数のパーティションを含むコンテナーに対する一括操作を修正しました

## <a name="3122-2021-07-21"></a>3.12.2 (2021-07-21)

### <a name="features-added"></a>追加された機能

- バンドルのサイズを縮小するためにターゲット ES2017 を採用しました。

## <a name="3121-2021-07-16"></a>3.12.1 (2021-07-16)

### <a name="bugs-fixed"></a>修正されたバグ

- 既定の retryPolicy オプション `fixedRetryIntervalInMilliseconds` をその元の既定値 0 に戻しました。

## <a name="3120-2021-07-06"></a>3.12.0 (2021-07-06)

### <a name="features-added"></a>追加された機能
- LTS に含まれなくなった Node.js バージョンのサポートが廃止された関係で、`@types/node` に対する依存関係がバージョン 12 に更新されました。 詳細については、Microsoft の[サポート ポリシー](https://github.com/Azure/azure-sdk-for-js/blob/main/SUPPORT.md)を参照してください。
- エンドポイント用のバックグラウンド リフレッシャーと新しい `ConnectionPolicy` オプションを追加しました。 既定値を true に更新しています。既定の更新レートは 5 分ごとです。
```js
const client = new CosmosClient({
  endpoint,
  key: masterKey,
  connectionPolicy: {
    ...defaultConnectionPolicy,
    endpointRefreshRateInMs: 700,
    enableBackgroundEndpointRefreshing: true
  }
})
```

- エンドポイントの更新を詳細に閉じるために `client.dispose()` を追加しました。 高速 Web サーバーなどの既存のプロセス内で CosmosClient を破棄する場合、またはクライアントを破棄して同じプロセスで新しいものを作成する場合に必要です。
```js
const client = new CosmosClient()
client.dispose() // cancels background endpoint refreshing
```

## <a name="3115-2021-06-10"></a>3.11.5 (2021-06-10)

### <a name="features-added"></a>追加された機能

### <a name="breaking-changes"></a>重大な変更

### <a name="key-bugs-fixed"></a>修正された主なバグ

### <a name="fixed"></a>固定

- バグの修正: 別のフェールオーバー条件を追加しました。

## <a name="3114-2021-06-10"></a>3.11.4 (2021-06-10)

- バグの修正: リージョンの DNS がオフラインになった場合に新しいリージョンに正しくフェールオーバーします。

## <a name="3113-2021-05-21"></a>3.11.3 (2021-05-21)

- バグの修正: AAD DataPlane RBAC トークン生成用のユーザー エンドポイント URL をサニタイズします。

## <a name="3112-2021-05-11"></a>3.11.2 (2021-05-11)

- バグの修正: 要求間で https クライアントをキャッシュします。

## <a name="3111-2021-05-06"></a>3.11.1 (2021-05-06)

- バグの修正: 組み込みモジュールではなく、ブラウザー/ノード shim から URL をインポートします。

## <a name="3110-2021-04-21"></a>3.11.0 (2021-04-21)

- 機能:内部的なクライアントの更新。 ユーザーが変更に直面することはありませんが、メジャー バージョンは安全のためにバンプします。

## <a name="3106-2021-04-14"></a>3.10.6 (2021-04-14)

- バグの修正: partitionKey パラメーターを `container.conflicts.delete` に追加しました

## <a name="3105-2021-03-25"></a>3.10.5 (2021-03-25)

- バグの修正: v1.2.0 の型に依存しているため、node-abort-controller バージョンをピン留めします。

## <a name="3104-2021-03-23"></a>3.10.4 (2021-03-23)

- 機能:一括 continueOnError オプションを追加しました。

## <a name="3103-2021-03-12"></a>3.10.3 (2021-03-12)

- バグの修正: 互換性を維持しながら、@azure/identity に対する直接的な依存関係を削除しました。

## <a name="3102-2021-03-11"></a>3.10.2 (2021-03-11)

- バグの修正: dev deps の依存関係 @azure/identity を修正しました。

## <a name="3101-2021-03-10"></a>3.10.1 (2021-03-10)

- バグの修正: Upsert 操作の ID を一括で自動生成します。

## <a name="3100-2021-01-21"></a>3.10.0 (2021-01-21)

- 機能:@azure/identity を介した AAD 認証を追加しました。

## <a name="395-2021-01-18"></a>3.9.5 (2021-01-18)

- バグの修正: 形式に誤りがあるトークンを使用して要求を行う場合に、適切な "無効な継続トークン" エラーをスローします
- バグの修正: 一括読み取り/削除操作で欠落している場合、partitionKeyValue は既定では `'[{}]'` になります
- バグの修正: null 値を使用して、パーティション間クエリのグループごとの操作を正しく合計します。

## <a name="393-2020-10-19"></a>3.9.3 (2020-10-19)

- バグの修正: 最上位レベルの partitionKey 値が未定義または null である一括操作を修正しました。

## <a name="392-2020-09-16"></a>3.9.2 (2020-09-16)

- バグの修正: Azure 関数での低速の `userAgent` 検索を修正しました。

## <a name="391-2020-08-28"></a>3.9.1 (2020-08-28)

- バグの修正: `OperationType` に基づいてより正確になるように `OperationInput` 型を修正しました。
- 機能: `Create` 操作を含む一括要求では、ID が存在しない場合、それを自動生成するようになりました。
- 機能:列挙型 `BulkOperationType` が追加され、一括要求を行うときに使用できるようになりました。

## <a name="390-2020-08-13"></a>3.9.0 (2020-08-13)

- 機能:コンテナーおよびデータベース作成のメソッドでの自動スケール パラメーターのサポートを追加しました

`throughput` を使用して `maxThroughput` を渡すことはできません。

```js
// correct
const containerDefinition = {
  id: "sample container",
  indexingPolicy: { indexingMode: IndexingMode.consistent },
  maxThroughput: 500,
  autoUpgradePolicy: {
    throughputPolicy: {
      incrementPercent: 15
    }
  }
};
database.container.create(containerDefinition)

// incorrect
const containerDefinition = {
  id: "sample container",
  indexingPolicy: { indexingMode: IndexingMode.consistent },
  throughput: 500, // do not specify throughput with maxThroughput
  maxThroughput: 500
  autoUpgradePolicy: {
    throughputPolicy: {
      incrementPercent: 15
    }
  }
};
database.container.create(containerDefinition)
```

## <a name="382-2020-08-12"></a>3.8.2 (2020-08-12)

- バグの修正: Node 8 用の checkURL 関数を修正しました

## <a name="381-2020-08-12"></a>3.8.1 (2020-08-12)

- バグの修正: ブラウザー/ノード用に個別の URL モジュールを追加します。

## <a name="380-2020-08-10"></a>3.8.0 (2020-08-10)

- 機能:無効なエンドポイントを使用して ClientContext を初期化すると、スローされます
- 機能:変更できないデータに対して型強制型変換の要求が出されないようにするために、内部の JSONArray 型を Array から ArrayLike に変更しました
- 機能:container.items に一括要求を追加しました。 次の型を持つ項目に対する最大 100 の操作の集計一括要求を許可します。Create、Upsert、Read、Replace、Delete

```js
// up to 100 operations
const operations: OperationInput[] = [
  {
    operationType: "Create",
    resourceBody: { id: "doc1", name: "sample", key: "A" }
  },
  {
    operationType: "Upsert",
    resourceBody: { id: "doc2", name: "other", key: "A" }
  },
  {
    operationType: "Read",
    id: "readItemId",
    partitionKey: "key"
  }
];

await database.container.items.bulk(operations);
```

## <a name="374-2020-06-30"></a>3.7.4 (2020-06-30)

- バグの修正: パーティション キー ヘッダーで ASCII "DEL" 文字を正しくエスケープします

## <a name="373-2020-06-29"></a>3.7.3 (2020-06-29)

- バグの修正: 自動 ID 生成による項目の作成と、ID でパーティション分割されたコンテナーの作成を行うことができません (#9734)

## <a name="372-2020-06-16"></a>3.7.2 (2020-06-16)

- バグの修正: ユーザーがカスタム中止シグナルを渡すと、内部中止シグナルが誤ってトリガーされました。 詳細については、#9510 を参照してください。

## <a name="371-2020-06-12"></a>3.7.1 (2020-06-12)

- バグの修正: globalCrypto.js での入力ミスが原因で、IE ブラウザーでエラーが発生します
- バグの修正: 項目の削除操作においてリソース トークンが一致しません (#9110)

## <a name="370-2020-06-08"></a>3.7.0 (2020-06-08)

- バグの修正: Internet Explorer ブラウザーで暗号化関数をサポートします
- バグの修正: `setAuthorizationHeader` によって返されるオブジェクトのキーの大文字と小文字の区別が正しくありません
- 機能: コンテナーとデータベースに `readOffer` メソッドを追加しました
- 機能: コンテナーの作成時に文字列値 `partitionKey` パラメーターを許可します

次の場合、動作は同じになります。

```js
const containerDefinition = {
  id: "sample container",
  indexingPolicy: { indexingMode: IndexingMode.consistent },
  throughput: 400,
  partitionKey: { paths: ["/key"] }
};
database.container.create(containerDefinition);

// OR as a string

const containerDefinition = {
  id: "sample container",
  indexingPolicy: { indexingMode: IndexingMode.consistent },
  throughput: 400,
  partitionKey: "/key" } // must have leading slash "/"
};
database.container.create(containerDefinition);
```

## <a name="363-2020-04-08"></a>3.6.3 (2020-04-08)

- 機能: クエリを単一のパーティション キー値にスコープするために、`FeedOptions` に `partitionKey` を追加しました

@azure/cosmos V2 には、クエリのパーティション キーを指定するために、2 種類の等価な方法が用意されています。

```js
// V2 These are effectively the same
container.items.query("SELECT * from c", { partitionKey: "foo" }).toArray();
container.items.query('SELECT * from c WHERE c.yourPartitionKey = "foo"').toArray();
```

簡略化するために、V3 SDK では、`FeedOptions` から `partitionKey` を削除したため、パーティション キーを指定する方法は 1 つしかありませんでした。

```js
// V3
container.items.query('SELECT * from c WHERE c.yourPartitionKey = "foo"').fetchAll();
```

お客様からのフィードバックに基づいて、`FeedOptions` を介したパーティション キーの引き渡しをサポートすることが依然として理にかなっているというシナリオを明らかにし、その動作を復元することにしました。

## <a name="362-2020-02-20"></a>3.6.2 (2020-02-20)

- バグの修正: これが === self である Web Worker でのサインインをサポートします

## <a name="361-2020-02-11"></a>3.6.1 (2020-02-11)

- バグの修正: エンドポイントを選択する際に場所名を正規化します。 正規化されたエンドポイント名を渡すことを許可します

## <a name="360-2020-02-10"></a>3.6.0 (2020-02-10)

- 機能: 空間インデックス作成、境界ボックス、地理空間構成に対するサポートを追加しました
- バグの修正:項目以外のリソースにおいて forceQueryPlan を QueryIterator に渡す場合のバグを修正しました (#7333)

## <a name="354-2020-01-28"></a>3.5.4 (2020-01-28)

- バグの修正: 要求料金を表す文字列ではなく、解析された数値を返します

## <a name="353-2020-01-06"></a>3.5.3 (2020-01-06)

- バグの修正: maxDegreeOfParallelism の既定値は 1 でしたが、コレクションのパーティションの数を既定値にする必要があります
- バグの修正: maxItemCount の既定値は 10 でしたが、既定値を未定義にする必要があります
- 既定の TLS バージョンを 1.2 に設定します (#6761)
- tslib 1.10.0 を使用します (#6710)
- コード サンプルにパーティション キーを追加しました (#6612)

## <a name="352-2019-12-03"></a>3.5.2 (2019-12-03)

- ブラウザーでトークンに署名する際の項目 ID 内の特殊文字の処理を修正します (#6379)

## <a name="351-2019-11-25"></a>3.5.1 (2019-11-25)

- GROUP BY クエリをページ分割するとき、または TOP/OFFSET/LIMIT と組み合わせて使用する場合のバグを修正します (#6003)
- 混合型 ORDER BY のエラー メッセージを改良しました (#6306)

## <a name="350-2019-11-21"></a>3.5.0 (2019-11-21)

- 機能: エンドポイントの検出および複数リージョンのフェールオーバーの機能強化。 この変更の詳細については、「 https://github.com/Azure/azure-sdk-for-js/pull/6283 」を参照してください。 (#6283)
- changeFeed およびクエリ オプションを省略可能にしました。 修正 #6232 修正 #6277 (#6273)

## <a name="342-2019-11-07"></a>3.4.2 (2019-11-07)

- 分割操作中にクエリが 410 エラーをスローする可能性があるというバグを修正しました。 代わりに、503 をスローします (#6074)

## <a name="341-2019-11-05"></a>3.4.1 (2019-11-05)

- リージョンのドロップ フェールオーバー シナリオを修正し、テストを追加しました (#5892)

## <a name="340-2019-10-28"></a>3.4.0 (2019-10-28)

- 機能:GROUP BY クエリのサポート (#5749)
- proxy-agent を更新しました。 types フォルダーを削除しました (#5854)
- 入力ミス: "an" と "a" を修正しました (#5812)
- Mocha 6.2.2 への更新を行いました (#5824)
- 未使用の範囲の型を削除しました (#5686)
- universal-user-agent を削除します (#5869)

## <a name="334-2019-10-14"></a>3.3.4 (2019-10-14)

- クエリのバグの修正。 空の結果の最後の呼び出しで、適切な RU が報告されません (#5517)
- 内部パッケージを使用してヘッダーに署名します (#5523)
- 暗号化ハッシュ パッケージではなく内部ダイジェスト関数を使用します (#5493)
- 内部の binary-search-bounds パッケージを削除しました (#5417)
- ブラウザー ユーザーに影響を与える atob のバグを修正します (#5375)

## <a name="332-2019-10-03"></a>3.3.2 (2019-10-03)

- TokenProvider および RequestInfo の型をエクスポートします (#5262)
- ローカル バージョンを優先して atob パッケージを削除しました (#5334)
- UserAgent での不適切な lib バージョンを修正しました (#5295)
- 項目 TTL にゼロを許可します (#5257)

## <a name="330-2019-09-24"></a>3.3.0 (2019-09-24)

- 機能: CosmosClient コンストラクター オプションに userAgentSuffix を追加しました (#5068)
- webpack の問題を修正するために process.env をガードします (#5223)
- 最初の QueryIterator Promise が作成されないというバグを修正しました (#5215)
- クエリから結果が返されなかった場合の集計バグを修正しました (#5184)
- sideEffects フィールドが false に設定されます (#5022)

## <a name="320-2019-08-26"></a>3.2.0 (2019-08-26)

- 機能: 初期化されるまで、エンドポイント解決がブロックされるようになります (#409)
- 機能: bufferItems およびその他のクロスパーティションのパフォーマンスを向上させました (#397)
- DOM をターゲットにしていないユーザーに対して AbortSignal 型が欠落している問題を修正します (#416)
- 継続トークンを使用した一括更新のサンプルを追加しました (#402)
- 既定のパーティション キー パスをエクスポートします (#405)

## <a name="311-2019-08-07"></a>3.1.1 (2019-08-07)

- オフセット カウントで各項目に対してオフセット制限反復子が呼び出されるというバグを修正しました (#398)
- EPIPE エラーに対する再試行を追加しました (#400)

## <a name="310-2019-07-26"></a>3.1.0 (2019-07-26)

- 機能:既定の ResponseContinuationTokenLimitInKB を 1kb に設定しました。 ヘッダー制限エラーを防止しました (#384)
- 未使用の disableSSLVerification オプションを削除します (#388)

## <a name="304-2019-07-22"></a>3.0.4 (2019-07-22)

- initialHeaders でパーティション キー ヘッダーを明示的に設定できるようにしました (#383)
- package.json#files を使用して、余分なファイルが公開されないようにしました (#382)
- 以前のバージョンの node+v8 でのルーティング マップの並べ替えエラーを修正しました (#378)
- ユーザーが部分再試行オプションを指定したときのバグを修正しました。 #377 を終了しました (#379)
- README 更新プログラム (#374)

## <a name="303-2019-07-17"></a>3.0.3 (2019-07-17)

- Webpack の使用を修正しました。 `require` で呼び出されたモジュールが解決されないようにしました (#373)
- さまざまな内部 API のクリーンアップとサンプル修正プログラム

## <a name="302-2019-07-09"></a>3.0.2 (2019-07-09)

RU が集計クエリに対して常に 0 として報告されるという、長い間未処理だったバグを修正しました (#366)

## <a name="301-2019-07-02"></a>3.0.1 (2019-07-02)

ブラウザーで壊れるセッション トークンを修正しました。 Cosmos では、ファイル システムに適した base64 を使用してリソースを内部的に表しますが、組み込みのブラウザー atob 関数では機能しません (#363)

## <a name="300-2019-06-28"></a>3.0.0 (2019-06-28)

🎉 v3 をリリースしました。 🎉 多くの新機能、バグ修正、いくつかの破壊的変更があります。 このリリースの主な目標:

- 主要な新機能を実装しました:
  - DISTINCT クエリ
  - LIMIT/OFFSET クエリ
  - ユーザーが取り消し可能な要求
- [すべてのコンテナーに無制限のスケールがある](https://docs.microsoft.com/azure/cosmos-db/migrate-containers-partitioned-to-nonpartitioned)最新の Cosmos REST API バージョンに更新しました
- ブラウザーから Cosmos を簡単に使用できるようにします
- 新しい [Azure JS SDK ガイドライン](https://azure.github.io/azure-sdk/typescript_introduction.html)との連携を強化しました

### <a name="migration-guide-for-breaking-changes"></a>破壊的変更のための移行ガイド

#### <a name="improved-client-constructor-options-246"></a>強化されたクライアント コンストラクター オプション (#246)

コンストラクター オプションが簡略化されました。

- `masterKey` は `key` の名前が変更され、最上位レベルに移動されました
- 以前は `options.auth` の下にあったプロパティが最上位レベルに移動されました

```js
// v2
const client = new CosmosClient({
  endpoint: "https://your-database.cosmos.azure.com",
  auth: {
    masterKey: "your-primary-key"
  }
});

// v3
const client = new CosmosClient({
  endpoint: "https://your-database.cosmos.azure.com",
  key: "your-primary-key"
});
```

#### <a name="simplified-queryiterator-api-238-316"></a>簡素化された QueryIterator API (#238 #316)

V2 には、クエリからの結果を反復処理または取得する方法が数多くありました。 v3 API を簡略化し、類似または重複する API を削除しようとしました。

- iterator.next() と iterator.current() を削除しました。 fetchNext() を使用して結果のページを取得します。
- iterator.forEach() を削除しました。 代わりに、非同期反復子を使用します。
- iterator.executeNext() の名前が iterator.fetchNext() に変更されました
- iterator.toArray() の名前が iterator.fetchAll() に変更されました
- ページは、プレーンな JS オブジェクトではなく、適切な `Response` オブジェクトになりました

```js
const container = client.database(dbId).container(containerId)

// v2
container.items.query('SELECT * from c').toArray()
container.items.query('SELECT * from c').executeNext()
container.items.query('SELECT * from c').forEach(({ body: item }) => { console.log(item.id) })

// v3
container.items.query('SELECT * from c').fetchAll()
container.items.query('SELECT * from c').fetchNext()
for await(const { result: item } in client.databases.readAll().getAsyncIterator()) {
    console.log(item.id)
}
```

#### <a name="simplified-partition-keys-for-queries"></a>クエリの簡略化されたパーティション キー

v2 には、クエリのパーティション キーを指定するために、2 種類の等価な方法が用意されています。

```js
// v2. These are effectively the same
container.items.query("SELECT * from c", { partitionKey: "foo" }).toArray();
container.items.query('SELECT * from c WHERE c.yourPartitionKey = "foo"').toArray();
```

v3 では `FeedOptions` から `partitionKey` が削除されているため、パーティション キーを指定する方法は現在 1 つしかありません。

```js
// v3
container.items.query('SELECT * from c WHERE c.yourPartitionKey = "foo"').fetchAll();
```

#### <a name="fixed-containers-are-now-paritioned-308"></a>パーティション分割されるようになった固定コンテナー (#308)

[Cosmos サービスでは、以前に固定コンテナーとして作成されたものも含め、すべてのコンテナー上でパーティション キーがサポートされるようになりました。](https://docs.microsoft.com/azure/cosmos-db/migrate-containers-partitioned-to-nonpartitioned) v3 SDK は、この変更を実装する最新の API バージョンに更新されますが、破壊的ではありません。 操作用のパーティション キーを指定しない場合、既定では、既存のすべてのコンテナーとドキュメントを操作するシステム キーが使用されます。

#### <a name="upsert-removed-for-stored-procedures-356"></a>ストアド プロシージャの `upsert` の削除 (#356)

以前は、パーティション分割されていないコレクションに対して `upsert` が許可されていましたが、API バージョンを更新すると、すべてのコレクションがパーティション分割されるので、これを完全に削除しました。

#### <a name="item-reads-will-not-throw-on-404-343-community-request"></a>項目の読み取りで 404 がスローされない (#343、コミュニティ要求)

```js
const container = client.database(dbId).container(containerId);

// v2
try {
  container.items.read(id, undefined);
} catch (e) {
  if (e.code === 404) {
    console.log("item not found");
  }
}

// v3
const { result: item } = container.items.read(id, undefined);
if (item === undefined) {
  console.log("item not found");
}
```

#### <a name="default-multi-region-write-335"></a>既定のマルチリージョンの書き込み (#335)

SDK では、データベース構成でサポートされている場合に、既定で複数のリージョンに書き込まれるようになりました。 これは、以前はオプトイン動作でした。

#### <a name="proper-error-objects-334-community-request"></a>適切なエラー オブジェクト (#334、コミュニティ要求)

失敗した要求では、適切な `Error` または `Error` のサブクラスがスローされるようになりました。 以前は、プレーン JS オブジェクトがスローされていました。

### <a name="new-features"></a>新機能

#### <a name="user-cancellable-requests-263-community-request"></a>ユーザーが取り消し可能な要求 (#263、コミュニティ要求)

内部での `fetch` への移行により、ブラウザーの `AbortController` API を使用して、ユーザーが取り消し可能な操作をサポートできます。 複数の要求が進行中の可能性がある操作 (クロス パーティション クエリなど) の場合、操作に対するすべての要求が取り消されます。 最新ブラウザーのユーザーには、既に `AbortController` があります。 Node.js ユーザーは[ポリフィル ライブラリ](https://www.npmjs.com/package/node-abort-controller)を使用する必要があります

```js
const controller = new AbortController();
const { result: item } = await items.query("SELECT * from c", { abortSignal: controller.signal });
controller.abort();
```

#### <a name="set-throughput-as-part-of-dbcontainer-create-operation-220"></a>db/コンテナー作成操作の一環としてのスループットの設定 (#220)

```js
const { database } = client.databases.create({ id: "my-database", throughput: 10000 });
database.containers.create({ id: "my-container", throughput: 10000 });
```

#### <a name="azurecosmos-sign-213"></a>@azure/cosmos-sign (#213)

ヘッダー トークンの生成が新しいライブラリ @azure/cosmos-sign に分割されました。 Cosmos REST API を直接呼び出すすべてのユーザーは、これを使用して、内部の @azure/cosmos を呼び出したのと同じコードを使用してヘッダーに署名できます。

#### <a name="uuid-for-generated-ids-355"></a>生成された ID の UUID (#355)

v2 には、項目 ID を生成するためのカスタム コードがありました。 既知の管理されたコミュニティ ライブラリ `uuid` に切り替えました。

#### <a name="connection-strings-350-community-request"></a>接続文字列 (#350、コミュニティ要求)

Azure portal からコピーした接続文字列を渡すことができるようになりました。

```js
const client = new CosmosClient(
  "AccountEndpoint=https://test-account.documents.azure.com:443/;AccountKey=<KEY HERE>;"
);
```

#### <a name="add-distinct-and-limitoffset-queries-306"></a>DISTINCT クエリと LIMIT/OFFSET クエリを追加します (#306)

```js
const { results } = await items.query("SELECT DISTINCT VALUE r.name FROM ROOT").fetchAll();
const { results } = await items.query("SELECT * FROM root r OFFSET 1 LIMIT 2").fetchAll();
```

### <a name="improved-browser-experience"></a>ブラウザー エクスペリエンスの改良

ブラウザー内で v2 SDK を使用することはできましたが、理想的なエクスペリエンスではありませんでした。 いくつかの node.js 組み込みライブラリをポリフィルし、Webpack やパーセルなどのバンドラーを使用する必要がありました。 v3 SDK を使用すると、ブラウザー ユーザーがすぐに利用できるエクスペリエンスが大幅に向上します。

- 要求の内部構造を `fetch` に置き換えました (#245)
- バッファーの使用を削除しました (#330)
- ユニバーサル パッケージ/API を優先してノードの組み込みの使用法を削除しました (#328)
- node-abort-controller に切り替えました (#294)

### <a name="bug-fixes"></a>バグの修正

- オファーの読み取りを修正し、オファーのテストを戻しました (#224)
- EnableEndpointDiscovery を修正しました (#207)
- ページ分割された結果で不足している RU を修正しました (#360)
- SQL クエリ パラメーターの種類を拡張しました (#346)
- ttl を ItemDefinition に追加しました (#341)
- CP クエリ メトリックを修正しました (#311)
- activityId を FeedResponse に追加しました (#293)
- \_ts の型を文字列から数値に切り替えました (#252)(#295)
- 要求の課金の集計を修正しました (#289)
- 空の文字列パーティション キーを許可しました (#277)
- 競合するクエリの種類に文字列を追加しました (#237)
- uniqueKeyPolicy をコンテナーに追加しました (#234)

### <a name="engineering-systems"></a>エンジニアリング システム

常に最も目立つ変更であるとは限りませんが、チームがより優れたコードをより迅速に提供するのに役立ちます。

- 運用ビルドのロールアップを使用しました (#104)
- Typescript 3.5 に更新しました (#327)
- TS プロジェクト参照に変換しました。 テスト フォルダーを抽出しました (#270)
- noUnusedLocals と noUnusedParameters を有効にしました (#275)
- CI ビルドのための Azure Pipelines YAML (#298)

## <a name="201-2018-09-25"></a>2.0.1 (2018-09-25)

- 型の問題を修正しました (#141 を参照)

## <a name="200-2018-09-24"></a>2.0.0 (2018-09-24)

- マルチリージョンの書き込みのサポート
- 応答に追加された、共有のリソース応答プロパティ
- すべてのリソースの種類に対して顧客の種類を許可するようにクエリを変更しました
- クロス パーティション クエリを許可するように items.query を変更しました
- その他の修正プログラム/ドキュメントの更新

## <a name="200-3-2018-08-02"></a>2.0.0-3 (2018-08-02)

- 新しいオブジェクト モデル
- ドキュメントおよびサンプルを更新しました
- 型を改良しました
- データベースとコンテナー用に `createdIfNotExists` を追加しました
- prettier を追加しました
- パブリック CI を追加しました (Travis と VSTS)

## <a name="200-0-2018-08-01"></a>2.0.0-0 (2018-08-01)

- Promise のサポートを追加しました
- 認証用のトークン ハンドラー オプションを追加しました
- ソースから型指定が出力されるようになりました (ソースを TypeScript に移動)
- CosmosClient を追加しました (DocumentClient は非推奨と見なされるようになりました)

## <a name="1144-2018-05-03"></a>1.14.4 (2018-05-03)

- npm のドキュメントを修正しました。

## <a name="1143-2018-05-03"></a>1.14.3 (2018-05-03)

- 接続に問題が発生したとき、デフォルトで再試行されるようになりました。
- コレクション変更フィードの読み取り対応になりました。
- "読み取りセッションを利用不可" を中断させるセッション整合性バグを修正しました。
- クエリ メトリック対応になりました。
- http エージェントの最大接続数を変更しました。

## <a name="1142-2017-12-21"></a>1.14.2 (2017-12-21)

- Azure Cosmos DB を使用するようにドキュメントを更新しました。
- ConnectionPolicy での proxyUrl 設定のサポートが追加されました。

## <a name="1141-2017-11-10"></a>1.14.1 (2017-11-10)

- 大文字と小文字を区別するファイル システムの軽微な修正です。

## <a name="1140-2017-11-09"></a>1.14.0 (2017-11-09)

- セッションの整合性のサポートが追加されます。
- この SDK バージョンでは、 https://aka.ms/cosmosdb-emulator からダウンロードできる Azure Cosmos DB エミュレーターの最新バージョンが必要です。

## <a name="1130-2017-10-11"></a>1.13.0 (2017-10-11)

- クロス パーティション クエリを分割検証しました。
- 先頭および末尾のスラッシュを含むリソース リンクのサポート (および対応するテスト) を追加します。

## <a name="1122-2017-08-10"></a>1.12.2 (2017-08-10)

- npm のドキュメントを修正しました。

## <a name="1121-2017-08-10"></a>1.12.1 (2017-08-10)

- ドキュメントに Unicode の特殊文字 (LS、PS) が含まれている場合の executeStoredProcedure のバグを修正しました。
- パーティション キーで Unicode 文字が使用されているドキュメントを処理する際のバグを修正しました。
- 名前メディアでコレクションを作成するためのサポートを修正しました (GitHub #114)。
- アクセス許可承認トークンのサポートを修正しました (GitHub #178)。

## <a name="1120-2017-05-10"></a>1.12.0 (2017-05-10)

- 1 分あたりの要求ユニット (RU/分) 機能のサポートが追加されました。
- ConsistentPrefix と呼ばれている新しい一貫性レベルに対応するようになりました。
- UriFactory のサポートを追加しました。
- Unicode サポートのバグを修正しました (GitHub #171)

## <a name="1110-2017-03-16"></a>1.11.0 (2017-03-16)

- 集計クエリ (COUNT、MIN、MAX、SUM、および AVG) のサポートを追加しました。
- クロス パーティション クエリの並列処理の次数を制御するオプションを追加しました。
- エミュレーターに対しての実行時に、SSL 検証を無効にするためのオプションを追加しました。
- パーティション分割コレクションの最小スループットが 10,100 RU/秒から 2,500 RU/秒になりました。
- 単一パーティション コレクションに関する継続トークンのバグを修正しました (github #107)。
- 0 を単一パラメーター として処理する際の executeStoredProcedure バグを修正しました (github #155)。

## <a name="1102-2017-01-27"></a>1.10.2 (2017-01-27)

- SDK バージョンを含めるようにユーザー エージェント ヘッダーを修正しました。
- コードの軽微なクリーンアップ。

## <a name="1101-2016-12-22"></a>1.10.1 (2016-12-22)

- SDK を使用して emulator(hostname=localhost) を対象とするときに SSL 検証が無効になります。
- ストアド プロシージャの実行時にスクリプトのログ記録を有効することができるようになりました。

## <a name="1100-2016-10-03"></a>1.10.0 (2016-10-03)

- クロス パーティションの並列クエリのサポートを追加しました。
- パーティション分割コレクションの TOP/ORDER BY クエリのサポートを追加しました。

## <a name="190-2016-07-07"></a>1.9.0 (2016-07-07)

- スロットルされた要求のための再試行ポリシー サポートを追加しました (スロットルされた要求は、要求レートが大きすぎるという例外をエラー コード 429 で受信します)。既定では、DocumentClient は、エラー コード 429 が発生した場合に、応答ヘッダーの retryAfter 回数に従って要求ごとに 9 回再試行します。
  再試行の間にサーバーによって返される retryAfter 回数を無視する場合、固定の再試行間隔の回数を、ConnectionPolicy オブジェクトの RetryOptions プロパティの一部としてここで設定できます。
  DocumentClient では、(再試行の回数に関係なく) スロットルされる要求ごとに最大 30 秒待機できるようになり、エラー コード 429 と共に応答を返すようになりました。
  この回数は、ConnectionPolicy オブジェクトの RetryOptions プロパティでオーバーライドすることもできます。

- DocumentClient は、スロットルの再試行の回数と再試行の間の要求の累積待機時間を表すために、すべての要求の応答ヘッダーとして x-ms-throttle-retry-count と x-ms-throttle-retry-wait-time-ms を返すようになりました。

- ConnectionPolicy クラスの RetryOptions プロパティを公開する、RetryOptions クラスが追加されました。これは、一部の既定の再試行オプションをオーバーライドするために使用できます。

## <a name="180-2016-06-14"></a>1.8.0 (2016-06-14)

- geo レプリケートされたデータベース アカウントのサポートを追加しました。

## <a name="170-2016-04-26"></a>1.7.0 (2016-04-26)

- ドキュメントの TimeToLive(TTL) 機能のサポートを追加しました。

## <a name="160-2016-03-29"></a>1.6.0 (2016-03-29)

- パーティション分割されたコレクションのサポートを追加しました。
- 新しいオファーの種類のサポートを追加しました。

## <a name="156-2016-03-08"></a>1.5.6 (2016-03-08)

- 結果の不適切な連結のためにリンクを返していなかった RangePartitionResolver.resolveForRead のバグを修正しました。
- compareFunction を Range クラスから RangePartitionResolver クラスに移動しました。

## <a name="155-2016-02-02"></a>1.5.5 (2016-02-02)

- hashParitionResolver resolveForRead() を修正しました - 登録済みのすべてのリンクの一覧を返す代わりに、指定したパーティション キーが例外をスローしない問題を修正しました。

## <a name="154-2016-02-01"></a>1.5.4 (2016-02-01)

- 専用 HTTPS エージェント: グローバルの変更を回避します lib のすべての要求に対して、専用エージェントを使用します。

## <a name="153-2016-01-26"></a>1.5.3 (2016-01-26)

- mediaIds 内でダッシュを適切に処理します。

## <a name="152-2016-01-22"></a>1.5.2 (2016-01-22)

- メモリ リークを修正しました。

## <a name="151-2016-01-04"></a>1.5.1 (2016-01-04)

- "Hash" ディレクトリの名前を "hash" に変更しました。

## <a name="150-2015-12-31"></a>1.5.0 (2015-12-31)

- クライアント側のシャーディングのサポートを追加しました。
- ハッシュ パーティション リゾルバーの実装を追加しました。
- 範囲のパーティション リゾルバーの実装を追加しました。

## <a name="140-2015-10-06"></a>1.4.0 (2015-10-06)

- Upsert を実装します。 documentClient の新しい upsertXXX メソッド

## <a name="130-2015-10-06"></a>1.3.0 (2015-10-06)

- 他の SDK とバージョン番号をそろえるため、このリリースはスキップされました。

## <a name="122-2015-09-10"></a>1.2.2 (2015-09-10)

- Q promises ラッパーを新しいリポジトリに分割します。
- 更新し、npm レジストリのファイルをパッケージ化します。

## <a name="121-2015-08-15"></a>1.2.1 (2015-08-15)

- ID ベースのルーティングを実装します。
- 問題 [#49](https://github.com/Azure/azure-documentdb-node/issues/49) を修正します - 現在のプロパティがメソッド current() と競合します。

## <a name="120-2015-08-05"></a>1.2.0 (2015-08-05)

- 地理空間インデックスのサポートを追加しました。
- すべてのリソースの id プロパティを検証します。 リソースの ID には ?、/、#、\\ の文字を使えず、終わりの文字をスペースにできません。
- ResourceResponse に新しいヘッダーとして "インデックス変換の進行状況" を追加しました。

## <a name="110-2015-07-09"></a>1.1.0 (2015-07-09)

- V2 インデックス作成ポリシーを実装します。

## <a name="103-2015-06-04"></a>1.0.3 (2015-06-04)

- 問題 [#40](https://github.com/Azure/azure-documentdb-node/issues/40) - core および promise SDK で eslint および grunt 構成を実装しました。

## <a name="102-2015-05-23"></a>1.0.2 (2015-05-23)

- 問題 [#45](https://github.com/Azure/azure-documentdb-node/issues/45) - promise ラッパーには、エラーのあるヘッダーが含まれません。

## <a name="101-2015-05-15"></a>1.0.1 (2015-05-15)

- readConflicts、readConflictAsync、queryConflicts を追加し、競合に関して問い合わせる機能を実装しました。
- API ドキュメントを更新しました。
- 問題 [#41](https://github.com/Azure/azure-documentdb-node/issues/41) - client.createDocumentAsync エラー。

Microsoft は、新しい/サポートされるバージョンに速やかに移行する目的で、SDK の提供終了を少なくともその **12 か月** 前に通知します。

新しい機能、機能性、および最適化は、現在の SDK にのみ追加されます。 そのため、常にできるだけ早く最新の SDK バージョンにアップグレードすることをお勧めします。

提供終了の SDK を使用した Cosmos DB への要求は、サービスによって拒否されます。

> [!WARNING]
> SQL API 用の Cosmos JavaScript SDK の **1.x** バージョンはすべて、**2020 年 8 月 30 日** に廃止されました。
>
> <br/>

| Version                  | リリース日       | 提供終了日 |
| ------------------------ | ------------------ | --------------- |
| [3.4.2](#3.4.2)          | 2019 年 11 月 7 日   | ---             |
| [3.4.1](#3.4.1)          | 2019 年 11 月 5 日   | ---             |
| [3.4.0](#3.4.0)          | 2019 年 10 月 28 日   | ---             |
| [3.3.6](#3.3.6)          | 2019 年 10 月 14 日   | ---             |
| [3.3.5](#3.3.5)          | 2019 年 10 月 14 日   | ---             |
| [3.3.4](#3.3.4)          | 2019 年 10 月 14 日   | ---             |
| [3.3.3](#3.3.3)          | 2019 年 10 月 3 日    | ---             |
| [3.3.2](#3.3.2)          | 2019 年 10 月 3 日    | ---             |
| [3.3.1](#3.3.1)          | 2019 年 10 月 1 日    | ---             |
| [3.3.0](#3.3.0)          | 2019 年 9 月 24 日 | ---             |
| [3.2.0](#3.2.0)          | 2019 年 8 月 26 日    | ---             |
| [3.1.1](#3.1.1)          | 2019 年 8 月 7 日     | ---             |
| [3.1.0](#3.1.0)          | 2019 年 7 月 26 日      | ---             |
| [3.0.4](#3.0.4)          | 2019 年 7 月 22 日      | ---             |
| [3.0.3](#3.0.3)          | 2019 年 7 月 17 日      | ---             |
| [3.0.2](#3.0.2)          | 2019 年 7 月 9 日       | ---             |
| [3.0.0](#3.0.0)          | 2019 年 6 月 28 日      | ---             |
| [2.1.5](#2.1.5)          | 2019 年 3 月 20 日     | ---             |
| [2.1.4](#2.1.4)          | 2019 年 3 月 15 日     | ---             |
| [2.1.3](#2.1.3)          | 2019 年 3 月 8 日      | ---             |
| [2.1.2](#2.1.2)          | 2019 年 1 月 28 日   | ---             |
| [2.1.1](#2.1.1)          | 2018 年 12 月 5 日   | ---             |
| [2.1.0](#2.1.0)          | 2018 年 12 月 4 日   | ---             |
| [2.0.5](#2.0.5)          | 2018 年 11 月 7 日   | ---             |
| [2.0.4](#2.0.4)          | 2018 年 10 月 30 日   | ---             |
| [2.0.3](#2.0.3)          | 2018 年 10 月 30 日   | ---             |
| [2.0.2](#2.0.2)          | 2018 年 10 月 10 日   | ---             |
| [2.0.1](#2.0.1)          | 2018 年 9 月 25 日 | ---             |
| [2.0.0](#2.0.0)          | 2018 年 9 月 24 日 | ---             |
| [2.0.0-3 (RC)](#2.0.0-3) | 2018 年 8 月 2 日     | ---             |
| [1.14.4](#1.14.4)        | 2018 年 5 月 3 日       | 2020 年 8 月 30 日 |
| [1.14.3](#1.14.3)        | 2018 年 5 月 3 日       | 2020 年 8 月 30 日 |
| [1.14.2](#1.14.2)        | 2017 年 12 月 21 日  | 2020 年 8 月 30 日 |
| [1.14.1](#1.14.1)        | 2017 年 11 月 10 日  | 2020 年 8 月 30 日 |
| [1.14.0](#1.14.0)        | 2017 年 11 月 9 日   | 2020 年 8 月 30 日 |
| [1.13.0](#1.13.0)        | 2017 年 10 月 11 日   | 2020 年 8 月 30 日 |
| [1.12.2](#1.12.2)        | 2017 年 8 月 10 日    | 2020 年 8 月 30 日 |
| [1.12.1](#1.12.1)        | 2017 年 8 月 10 日    | 2020 年 8 月 30 日 |
| [1.12.0](#1.12.0)        | 2017 年 5 月 10 日       | 2020 年 8 月 30 日 |
| [1.11.0](#1.11.0)        | 2017 年 3 月 16 日     | 2020 年 8 月 30 日 |
| [1.10.2](#1.10.2)        | 2017 年 1 月 27 日   | 2020 年 8 月 30 日 |
| [1.10.1](#1.10.1)        | 2016 年 12 月 22 日  | 2020 年 8 月 30 日 |
| [1.10.0](#1.10.0)        | 2016 年 10 月 3 日   | 2020 年 8 月 30 日 |
| [1.9.0](#1.9.0)          | 2016 年 7 月 7 日      | 2020 年 8 月 30 日 |
| [1.8.0](#1.8.0)          | 2016 年 6 月 14 日      | 2020 年 8 月 30 日 |
| [1.7.0](#1.7.0)          | 2016 年 4 月 26 日     | 2020 年 8 月 30 日 |
| [1.6.0](#1.6.0)          | 2016 年 3 月 29 日     | 2020 年 8 月 30 日 |
| [1.5.6](#1.5.6)          | 2016 年 3 月 8 日     | 2020 年 8 月 30 日 |
| [1.5.5](#1.5.5)          | 2016 年 2 月 2 日  | 2020 年 8 月 30 日 |
| [1.5.4](#1.5.4)          | 2016 年 2 月 1 日  | 2020 年 8 月 30 日 |
| [1.5.3](#1.5.2)          | 2016 年 1 月 26 日   | 2020 年 8 月 30 日 |
| [1.5.2](#1.5.2)          | 2016 年 1 月 22 日   | 2020 年 8 月 30 日 |
| [1.5.1](#1.5.1)          | 2016 年 1 月 4 日    | 2020 年 8 月 30 日 |
| [1.5.0](#1.5.0)          | 2015 年 12 月 31 日  | 2020 年 8 月 30 日 |
| [1.4.0](#1.4.0)          | 2015 年 10 月 6 日   | 2020 年 8 月 30 日 |
| [1.3.0](#1.3.0)          | 2015 年 10 月 6 日   | 2020 年 8 月 30 日 |
| [1.2.2](#1.2.2)          | 2015 年 9 月 10 日 | 2020 年 8 月 30 日 |
| [1.2.1](#1.2.1)          | 2015 年 8 月 15 日    | 2020 年 8 月 30 日 |
| [1.2.0](#1.2.0)          | 2015 年 8 月 5 日    | 2020 年 8 月 30 日 |
| [1.1.0](#1.1.0)          | 2015 年 7 月 9 日      | 2020 年 8 月 30 日 |
| [1.0.3](#1.0.3)          | 2015 年 6 月 4 日      | 2020 年 8 月 30 日 |
| [1.0.2](#1.0.2)          | 2015 年 5 月 23 日       | 2020 年 8 月 30 日 |
| [1.0.1](#1.0.1)          | 2015 年 5 月 15 日       | 2020 年 8 月 30 日 |
| [1.0.0](#1.0.0)          | 2015 年 4 月 8 日     | 2020 年 8 月 30 日 |
