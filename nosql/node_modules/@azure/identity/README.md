---
ms.openlocfilehash: 8013ef1413fb83a07c8c31eb731be49ba57bbb66
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052715"
---
## <a name="azure-identity-client-library-for-javascript"></a>JavaScript 用 Azure ID クライアント ライブラリ

Azure ID ライブラリは、Azure SDK 全体で Azure Active Directory トークン認証のサポートを提供します。 これは、AAD トークン認証をサポートする Azure SDK クライアントを構築するために使用できる一連の [TokenCredential](https://docs.microsoft.com/javascript/api/@azure/core-auth/tokencredential) 実装を提供します。

これらのさまざまな資格情報の例は、[Azure ID の例のページ](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)にあります

[ソース コード](https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/identity/identity) | [パッケージ (npm)](https://www.npmjs.com/package/@azure/identity) | [API リファレンス ドキュメント](https://docs.microsoft.com/javascript/api/@azure/identity) | [製品ドキュメント](https://azure.microsoft.com/services/active-directory/) | [サンプル](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/samples)

## <a name="getting-started"></a>はじめに

### <a name="currently-supported-environments"></a>現在サポートされている環境

- [Node.js の LTS バージョン](https://nodejs.org/about/releases/)
- Safari、Chrome、Edge、Firefox の最新バージョン。
  - 注: このライブラリでエクスポートされるさまざまな資格情報のうち、ブラウザーでサポートされているのは `InteractiveBrowserCredential` のみです。

### <a name="install-the-package"></a>パッケージをインストールする

`npm` を使用して Azure ID をインストールします。

```sh
npm install --save @azure/identity
```

### <a name="prerequisites"></a>前提条件

- Node.js 8 LTS 以降。
- [Azure サブスクリプション](https://azure.microsoft.com/free/)。
- [Azure CLI][azure_cli] は、開発環境での認証とアカウント ロールの管理にも役立ちます。

### <a name="authenticate-the-client-in-development-environment"></a>開発環境でクライアントを認証する

運用アプリケーションではマネージド ID またはサービス プリンシパル認証を使用することをお勧めしますが、開発者は、コードをローカルでデバッグして実行するときに、Azure サービスの呼び出しを認証するために独自のアカウントを使用するのが一般的です。 開発環境でこの認証を実行するために使用できる開発者ツールがいくつかあります。

#### <a name="authenticating-via-visual-studio-code"></a>Visual Studio Code を使用した認証

Visual Studio Code を使用する開発者は、[Azure アカウント拡張機能](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account)を使って IDE を介して認証できます。 その後、`DefaultAzureCredential` または `VisualStudioCodeCredential` を使用するアプリケーションでこのアカウントを使用して、ローカルでの実行時にアプリケーションの呼び出しを認証できます。

Visual Studio Code で認証するには、まず [Azure アカウント拡張機能](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account)がインストールされていることを確認します。 拡張機能がインストールされていたら、`F1` キーを押してコマンド パレットを開き、`Azure: Sign In` コマンドを実行します。

![Visual Studio Code でのアカウントのサインイン][vscodelogincommand_image]

#### <a name="authenticating-via-the-azure-cli"></a>Azure CLI を使用した認証

直接または `DefaultAzureCredential` ではなく、`AzureCliCredential` を使用するアプリケーションは、Azure CLI アカウントを使用して、ローカルでの実行時にアプリケーションの呼び出しを認証できます。

[Azure CLI][azure_cli] を使用して認証するには、ユーザーはコマンド `az login` を実行します。 既定の Web ブラウザーを使用しているシステムで実行しているユーザーの場合、Azure CLI でブラウザーが起動され、ユーザーが認証されます。

![Azure CLI でのアカウントのサインイン][azureclilogin_image]

既定の Web ブラウザーがないシステムの場合は、`az login` コマンドでデバイス コード認証フローを使用します。 ユーザーは、`--use-device-code` 引数を指定してブラウザーを起動するのではなく、Azure CLI でデバイス コード フローを使用するように強制することもできます。

![Azure CLI でのアカウントのデバイス コード サインイン][azureclilogindevicecode_image]

### <a name="authenticate-the-client-in-browsers"></a>ブラウザーでクライアントを認証する

現在、Web ブラウザー内で Azure SDK を認証するために `InteractiveBrowserCredential` が提供されています。これは、リダイレクトまたはポップアップを使用して認証フローを完了するように設定できます。 まず、ポータルで Web アプリケーションの [Azure アプリ登録を作成](https://docs.microsoft.com/azure/active-directory/develop/scenario-spa-app-registration)する必要があります。

## <a name="key-concepts"></a>主要な概念

`@azure/identity` または Microsoft ID プラットフォーム (Azure Active Directory) を初めて使用する場合は、まず「[Microsoft ID プラットフォームで `@azure/identity` を使用する](https://github.com/Azure/azure-sdk-for-js/blob/master/documentation/using-azure-identity.md)」をお読みください。 このドキュメントでは、プラットフォームの詳細と、Azure アカウントを正しく構成する方法について説明しています。

### <a name="credentials"></a>資格情報

資格情報はクラスの一種であり、サービス クライアントが要求を認証するために必要なデータを格納または取得できます。 Azure SDK のサービス クライアントは、その作成時に資格情報を受け取り、これらの資格情報を使用してサービス要求の認証を行います。

Azure ID ライブラリは Azure Active Directory での OAuth 認証に焦点を当てており、サービス要求を認証するための AAD トークンを取得できるさまざまな資格情報クラスが用意されています。 このライブラリ内のすべての資格情報クラスは [TokenCredential](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/core/core-auth/src/tokenCredential.ts) 抽象クラスの実装です。これらはいずれも、TokenCredential で認証できるサービス クライアントの作成に使用できます。

「[資格情報クラス](#credential-classes)」を参照してください。

### <a name="defaultazurecredential"></a>DefaultAzureCredential

`DefaultAzureCredential` は、最終的にアプリケーションが Azure クラウドで実行されるように設計されているほとんどのシナリオに適しています。 これは、一般的にデプロイ時の認証に使用される資格情報と、開発環境での認証に使用される資格情報が組み合わせて `DefaultAzureCredential` に使用されているためです。 `DefaultAzureCredential` は、次のメカニズムを順に経由して認証を試行します。

![DefaultAzureCredential の認証フロー][defaultauthflow_image]

- 環境 - `DefaultAzureCredential` は、[環境変数](#environment-variables)で指定されたアカウント情報を読み取り、それを使用して認証を行います。
- マネージド ID - マネージド ID が有効な Azure ホストにアプリケーションがデプロイされている場合、`DefaultAzureCredential` により、そのアカウントを使用して認証されます。
- Visual Studio Code - 開発者が Visual Studio Code Azure Account プラグインを介して認証した場合、`DefaultAzureCredential` により、そのアカウントを使用して認証されます。
- Azure CLI - 開発者が Azure CLI `az login` コマンドを使用してアカウントを認証した場合、`DefaultAzureCredential` により、そのアカウントを使用して認証されます。

## <a name="environment-variables"></a>環境変数

`DefaultAzureCredential` と `EnvironmentCredential` は環境変数を使用して構成できます。 認証の種類ごとに、特定の変数の値が必要です。

#### <a name="service-principal-with-secret"></a>シークレットを持つサービス プリンシパル

| 変数名         | value                                                 |
| --------------------- | ----------------------------------------------------- |
| `AZURE_CLIENT_ID`     | Azure Active Directory アプリケーションの ID           |
| `AZURE_TENANT_ID`     | アプリケーションの Azure Active Directory テナントの ID |
| `AZURE_CLIENT_SECRET` | アプリケーションのクライアント シークレットの 1 つ               |

#### <a name="service-principal-with-certificate"></a>証明書を使用したサービス プリンシパル

| 変数名                   | value                                                                                      |
| ------------------------------- | ------------------------------------------------------------------------------------------ |
| `AZURE_CLIENT_ID`               | Azure Active Directory アプリケーションの ID                                                |
| `AZURE_TENANT_ID`               | アプリケーションの Azure Active Directory テナントの ID                                      |
| `AZURE_CLIENT_CERTIFICATE_PATH` | (パスワード保護のない) 秘密キーを含む、PEM でエンコードされた証明書ファイルへのパス |

#### <a name="username-and-password"></a>ユーザー名とパスワード

| 変数名     | value                                       |
| ----------------- | ------------------------------------------- |
| `AZURE_CLIENT_ID` | Azure Active Directory アプリケーションの ID |
| `AZURE_USERNAME`  | ユーザー名 (通常はメール アドレス)       |
| `AZURE_PASSWORD`  | そのユーザーのパスワード                        |

構成は上記の順序で試行されます。 たとえば、クライアント シークレットと証明書の値が両方存在する場合、クライアント シークレットが使用されます。

## <a name="examples"></a>例

さまざまな資格情報のその他の使用例については、[Azure ID の例のページ](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)を参照してください

### <a name="authenticating-with-the-defaultazurecredential"></a>`DefaultAzureCredential` を使用した認証

この例では、`DefaultAzureCredential` を使用して [@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys) クライアント ライブラリから `KeyClient` を認証することを示しています。

```javascript
// The default credential first checks environment variables for configuration as described above.
// If environment configuration is incomplete, it will try managed identity.

// Azure Key Vault service to use
const { KeyClient } = require("@azure/keyvault-keys");

// Azure authentication library to access Azure Key Vault
const { DefaultAzureCredential } = require("@azure/identity");

// Azure SDK clients accept the credential as a parameter
const credential = new DefaultAzureCredential();

// Create authenticated client
const client = new KeyClient(vaultUrl, credential);

// Use service from authenticated client
const getResult = await client.getKey("MyKeyName");
```

### <a name="specifying-a-user-assigned-managed-identity-with-the-defaultazurecredential"></a>`DefaultAzureCredential` を使用してユーザー割り当てのマネージド ID を指定する

比較的一般的なシナリオでは、Azure リソースのユーザー割り当てマネージド ID を使用した認証が行われます。 [DefaultAzureCredential を使用してユーザー割り当てマネージド ID を認証する方法の例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-assigned-managed-identity-with-defaultazurecredential)を調べ、環境変数を使用するかコードで構成できる比較的簡単なタスクにする方法を確認します。

### <a name="define-a-custom-authentication-flow-with-the-chainedtokencredential"></a>`ChainedTokenCredential` を使用してカスタム認証フローを定義する

一般に `DefaultAzureCredential` は Azure 用アプリケーションの開発を開始する最も簡単な方法ですが、より上級のユーザーは、認証時に考慮される資格情報をカスタマイズできます。 `ChainedTokenCredential` を使用すると、ユーザーは複数の資格情報インスタンスを組み合わせて、カスタマイズされた資格情報チェーンを定義できます。 この例では、`ChainedTokenCredential` を作成し、構成の異なる `ClientSecretCredential` の 2 つのインスタンスを使用して認証を試みた後、[@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys) から `KeyClient` を認証する方法を方法を示します。

```javascript
const { ClientSecretCredential, ChainedTokenCredential } = require("@azure/identity");

// When an access token is requested, the chain will try each
// credential in order, stopping when one provides a token
const firstCredential = new ClientSecretCredential(tenantId, clientId, clientSecret);
const secondCredential = new ClientSecretCredential(tenantId, anotherClientId, anotherSecret);
const credentialChain = new ChainedTokenCredential(firstCredential, secondCredential);

// The chain can be used anywhere a credential is required
const { KeyClient } = require("@azure/keyvault-keys");
const client = new KeyClient(vaultUrl, credentialChain);
```

## <a name="managed-identity-support"></a>マネージド ID のサポート

[マネージド ID 認証](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)は、次の Azure ホストの `DefaultAzureCredential` または `ManagedIdentityCredential` 資格情報クラスを介して直接サポートされます。

- [Azure Virtual Machines](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token)
- [Azure App Service](https://docs.microsoft.com/azure/app-service/overview-managed-identity)
- [Azure Kubernetes Service](https://docs.microsoft.com/azure/aks/use-managed-identity)
- [Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/msi-authorization)
- [Azure Arc](https://docs.microsoft.com/azure/azure-arc/servers/managed-identity-authentication)
- [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/concepts-managed-identity)

認証にマネージド ID を使用する方法の例については、[こちら](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)を参照してください

## <a name="credential-classes"></a>資格情報クラス

### <a name="authenticating-azure-hosted-applications"></a>Azure でホストされているアプリケーションの認証

| 資格情報 (credential)                  | usage                                                                                                            | 例                                                                                                                                                                                                |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `DefaultAzureCredential`    | Azure クラウドで実行されるアプリケーションの開発を迅速に開始するための簡単な認証エクスペリエンスを提供します。 | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-with-defaultazurecredential)                      |
| `ChainedTokenCredential`    | ユーザーが複数の資格情報で構成されるカスタム認証フローを定義できるようにします。                               | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#chaining-credentials)                                            |
| `EnvironmentCredential`     | 環境変数で指定された資格情報を使用して、サービス プリンシパルまたはユーザーを認証します。         | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-environment-credentials) |
| `ManagedIdentityCredential` | Azure リソースのマネージド ID を認証します。                                                         | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)                   |

### <a name="authenticating-service-principals"></a>サービス プリンシパルの認証

| 資格情報 (credential)                    | usage                                                  | 例                                                                                                                                                                                             | reference                                                                                                                        |
| ----------------------------- | ------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| `ClientSecretCredential`      | シークレットを使用してサービス プリンシパルを認証します。      | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-secret)      | [サービス プリンシパルの認証](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |
| `ClientCertificateCredential` | 証明書を使用してサービス プリンシパルを認証します。 | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-certificate) | [サービス プリンシパルの認証](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |

### <a name="authenticating-users"></a>ユーザーの認証

| 資格情報 (credential)                     | usage                                                                                                                                                                                                                       | 例                                                                                                                                                                                           | reference                                                                                                        |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `InteractiveBrowserCredential` | 既定のシステム ブラウザーを使用してユーザーを対話形式で認証します。 このしくみの詳細については、[こちらを参照してください](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/interactive-browser-credential.md)。 | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-interactively-in-the-browser) | [OAuth2 認証コード](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |
| `DeviceCodeCredential`         | UI が制限されているデバイスでユーザーを対話形式で認証します。                                                                                                                                                              | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-device-code-flow)        | [デバイス コード認証](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-device-code)    |
| `UserPasswordCredential`       | ユーザー名とパスワードを使用してユーザーを認証します。                                                                                                                                                                          | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-username-and-password)   | [ユーザー名とパスワードによる認証](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc)    |
| `AuthorizationCodeCredential`  | 前もって取得した承認コードを使用してユーザーを認証します。                                                                                                                                                          | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-auth-code-flow)          | [OAuth2 認証コード](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |

### <a name="authenticating-via-development-tools"></a>開発ツールを使用した認証

| 資格情報 (credential)                   | usage                                                              | 例                                                                                                                                                                                      | reference                                                                               |
| ---------------------------- | ------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| `AzureCliCredential`         | 開発環境で Azure CLI を使用して認証します。      | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-azure-cli)          | [Azure CLI 認証](https://docs.microsoft.com/cli/azure/authenticate-azure-cli) |
| `VisualStudioCodeCredential` | 開発環境で Visual Studio Code を使用して認証します。 | [例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-visual-studio-code) | [VS Code の Azure 拡張機能](https://code.visualstudio.com/docs/azure/extensions)          |

## <a name="troubleshooting"></a>トラブルシューティング

### <a name="error-handling"></a>エラー処理

資格情報で認証できなかった場合は、`AuthenticationError` が発生します。 このクラスには、認証が失敗した理由を示す `message` フィールドがあります。 `AggregateAuthenticationError` は、`ChainedTokenCredential` によって発生し、`errors` フィールドにチェーン内の各資格情報からのエラーの配列が含まれます。

### <a name="logging"></a>ログの記録

ログの記録を有効にすると、エラーに関する有用な情報を明らかにするのに役立つ場合があります。 HTTP 要求と応答のログを表示するには、環境変数 `AZURE_LOG_LEVEL` を `info` に設定します。 または、`@azure/logger` で `setLogLevel` を呼び出して、実行時にログ記録を有効にすることもできます。

```javascript
import { setLogLevel } from "@azure/logger";

setLogLevel("info");
```

## <a name="next-steps"></a>次のステップ

### <a name="read-the-documentation"></a>ドキュメントを読む

このライブラリの API ドキュメントは、[ドキュメント サイト](https://docs.microsoft.com/javascript/api/@azure/identity)にあります。

### <a name="provide-feedback"></a>フィードバックの提供

バグが発生した場合や提案がある場合は、[issue をオープン](https://github.com/Azure/azure-sdk-for-js/issues)してください。

## <a name="contributing"></a>共同作成

このライブラリに投稿する場合、コードをビルドしてテストする方法の詳細については、[投稿ガイド](https://github.com/Azure/azure-sdk-for-js/blob/master/CONTRIBUTING.md)を参照してください。

[1]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/defaultazurecredential.html
[2]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/managedidentitycredential.html
[3]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/environmentcredential.html
[4]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientsecretcredential.html
[5]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientcertificatecredential.html
[6]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/devicecodecredential.html
[7]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/authorizationcodecredential.html
[8]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/interactivebrowsercredential.html
[9]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/usernamepasswordcredential.html
[azure_cli]: https://docs.microsoft.com/cli/azure
[vscodelogincommand_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/VsCodeLoginCommand.png
[azureclilogin_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLogin.png
[azureclilogindevicecode_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLoginDeviceCode.png
[defaultauthflow_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/DefaultAzureCredentialAuthenticationFlow.png

![インプレッション数](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fidentity%2Fidentity%2FREADME.png)
